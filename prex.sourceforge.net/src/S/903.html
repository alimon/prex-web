<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>usr/server/fs/vfs/main.c</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-5.6.1' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<body>
<div id="middle">
<table id="content" border="0" cellpadding="0" cellspacing="0" width="100%">
  <tbody>

    <tr>
      <td id="header" colspan="2" valign="top">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td id="logo">
            <a href="../../index.html">
            <img alt="Prex logo" src="../../img/logo.gif" border="0"
            style="width: 250px; height: 54px;"></a>
          </td>
          <td id="brief" align="right" valign="bottom">
            An Open Source, Royalty-free,<br>
	    Real-time Operating System
          </td>
        </tr>
        </table>
      </td>
    </tr>

    <tr>
      <td id="directory" style="vertical-align: top;"><p>
      <a href="../../index.html">Prex Home</a> /
      <a href="../index.html">Browse Source</a>
      - Prex Version: 0.9.0</p>
      </td>
    </tr>

    <tr>
      <td id="main" style="vertical-align: top;">
<a id='TOP' name='TOP' /><h2 class='header'><a href='../mains.html'>root</a>/<a href='../files/1085.html'>usr</a>/<a href='../files/1162.html'>server</a>/<a href='../files/1165.html'>fs</a>/<a href='../files/1171.html'>vfs</a>/main.c</h2>
<em class='comment'>/* [&lt;][&gt;]<a href='903.html#L89'>[^]</a><a href='903.html#L1092'>[v]</a>[top]<a href='903.html#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<hr />
<h2 class='header'>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='903.html#L89' title='Defined at 89.'>fs_mount</a></li>
<li><a href='903.html#L109' title='Defined at 109.'>fs_umount</a></li>
<li><a href='903.html#L120' title='Defined at 120.'>fs_sync</a></li>
<li><a href='903.html#L127' title='Defined at 127.'>fs_open</a></li>
<li><a href='903.html#L163' title='Defined at 163.'>fs_close</a></li>
<li><a href='903.html#L185' title='Defined at 185.'>fs_mknod</a></li>
<li><a href='903.html#L197' title='Defined at 197.'>fs_lseek</a></li>
<li><a href='903.html#L214' title='Defined at 214.'>fs_read</a></li>
<li><a href='903.html#L234' title='Defined at 234.'>fs_write</a></li>
<li><a href='903.html#L254' title='Defined at 254.'>fs_ioctl</a></li>
<li><a href='903.html#L265' title='Defined at 265.'>fs_fsync</a></li>
<li><a href='903.html#L276' title='Defined at 276.'>fs_fstat</a></li>
<li><a href='903.html#L291' title='Defined at 291.'>fs_opendir</a></li>
<li><a href='903.html#L313' title='Defined at 313.'>fs_closedir</a></li>
<li><a href='903.html#L332' title='Defined at 332.'>fs_readdir</a></li>
<li><a href='903.html#L343' title='Defined at 343.'>fs_rewinddir</a></li>
<li><a href='903.html#L354' title='Defined at 354.'>fs_seekdir</a></li>
<li><a href='903.html#L367' title='Defined at 367.'>fs_telldir</a></li>
<li><a href='903.html#L384' title='Defined at 384.'>fs_mkdir</a></li>
<li><a href='903.html#L396' title='Defined at 396.'>fs_rmdir</a></li>
<li><a href='903.html#L410' title='Defined at 410.'>fs_rename</a></li>
<li><a href='903.html#L429' title='Defined at 429.'>fs_chdir</a></li>
<li><a href='903.html#L451' title='Defined at 451.'>fs_fchdir</a></li>
<li><a href='903.html#L467' title='Defined at 467.'>fs_link</a></li>
<li><a href='903.html#L474' title='Defined at 474.'>fs_unlink</a></li>
<li><a href='903.html#L488' title='Defined at 488.'>fs_stat</a></li>
<li><a href='903.html#L503' title='Defined at 503.'>fs_getcwd</a></li>
<li><a href='903.html#L514' title='Defined at 514.'>fs_dup</a></li>
<li><a href='903.html#L541' title='Defined at 541.'>fs_dup2</a></li>
<li><a href='903.html#L573' title='Defined at 573.'>fs_fcntl</a></li>
<li><a href='903.html#L619' title='Defined at 619.'>fs_access</a></li>
<li><a href='903.html#L641' title='Defined at 641.'>fs_fork</a></li>
<li><a href='903.html#L685' title='Defined at 685.'>fs_exec</a></li>
<li><a href='903.html#L721' title='Defined at 721.'>fs_exit</a></li>
<li><a href='903.html#L747' title='Defined at 747.'>fs_register</a></li>
<li><a href='903.html#L759' title='Defined at 759.'>fs_pipe</a></li>
<li><a href='903.html#L805' title='Defined at 805.'>fs_isatty</a></li>
<li><a href='903.html#L820' title='Defined at 820.'>fs_truncate</a></li>
<li><a href='903.html#L834' title='Defined at 834.'>fs_ftruncate</a></li>
<li><a href='903.html#L848' title='Defined at 848.'>fs_boot</a></li>
<li><a href='903.html#L883' title='Defined at 883.'>fs_shutdown</a></li>
<li><a href='903.html#L891' title='Defined at 891.'>fs_noop</a></li>
<li><a href='903.html#L901' title='Defined at 901.'>fs_debug</a></li>
<li><a href='903.html#L913' title='Defined at 913.'>vfs_init</a></li>
<li><a href='903.html#L945' title='Defined at 945.'>run_thread</a></li>
<li><a href='903.html#L966' title='Defined at 966.'>exception_handler</a></li>
<li><a href='903.html#L1027' title='Defined at 1027.'>fs_thread</a></li>
<li><a href='903.html#L1092' title='Defined at 1092.'>main</a></li>
</ol>
<hr />
<pre>
<a id='L1' name='L1' />   1 <em class='comment'>/*</em>
<a id='L2' name='L2' />   2 <em class='comment'> * Copyright (c) 2005-2007, Kohsuke Ohtani</em>
<a id='L3' name='L3' />   3 <em class='comment'> * All rights reserved.</em>
<a id='L4' name='L4' />   4 <em class='comment'> *</em>
<a id='L5' name='L5' />   5 <em class='comment'> * Redistribution and use in source and binary forms, with or without</em>
<a id='L6' name='L6' />   6 <em class='comment'> * modification, are permitted provided that the following conditions</em>
<a id='L7' name='L7' />   7 <em class='comment'> * are met:</em>
<a id='L8' name='L8' />   8 <em class='comment'> * 1. Redistributions of source code must retain the above copyright</em>
<a id='L9' name='L9' />   9 <em class='comment'> *    notice, this list of conditions and the following disclaimer.</em>
<a id='L10' name='L10' />  10 <em class='comment'> * 2. Redistributions in binary form must reproduce the above copyright</em>
<a id='L11' name='L11' />  11 <em class='comment'> *    notice, this list of conditions and the following disclaimer in the</em>
<a id='L12' name='L12' />  12 <em class='comment'> *    documentation and/or other materials provided with the distribution.</em>
<a id='L13' name='L13' />  13 <em class='comment'> * 3. Neither the name of the author nor the names of any co-contributors</em>
<a id='L14' name='L14' />  14 <em class='comment'> *    may be used to endorse or promote products derived from this software</em>
<a id='L15' name='L15' />  15 <em class='comment'> *    without specific prior written permission.</em>
<a id='L16' name='L16' />  16 <em class='comment'> *</em>
<a id='L17' name='L17' />  17 <em class='comment'> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND</em>
<a id='L18' name='L18' />  18 <em class='comment'> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</em>
<a id='L19' name='L19' />  19 <em class='comment'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</em>
<a id='L20' name='L20' />  20 <em class='comment'> * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE</em>
<a id='L21' name='L21' />  21 <em class='comment'> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</em>
<a id='L22' name='L22' />  22 <em class='comment'> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</em>
<a id='L23' name='L23' />  23 <em class='comment'> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</em>
<a id='L24' name='L24' />  24 <em class='comment'> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</em>
<a id='L25' name='L25' />  25 <em class='comment'> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</em>
<a id='L26' name='L26' />  26 <em class='comment'> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</em>
<a id='L27' name='L27' />  27 <em class='comment'> * SUCH DAMAGE.</em>
<a id='L28' name='L28' />  28 <em class='comment'> */</em>
<a id='L29' name='L29' />  29 
<a id='L30' name='L30' />  30 <em class='comment'>/*</em>
<a id='L31' name='L31' />  31 <em class='comment'> * main.c - File system server</em>
<a id='L32' name='L32' />  32 <em class='comment'> */</em>
<a id='L33' name='L33' />  33 
<a id='L34' name='L34' />  34 <em class='comment'>/*</em>
<a id='L35' name='L35' />  35 <em class='comment'> * All file systems work as a sub-modules under VFS (Virtual File System).</em>
<a id='L36' name='L36' />  36 <em class='comment'> * The routines in this file have the responsible to the following jobs.</em>
<a id='L37' name='L37' />  37 <em class='comment'> *</em>
<a id='L38' name='L38' />  38 <em class='comment'> *  - Interpret the IPC message and pass the request into VFS routines.</em>
<a id='L39' name='L39' />  39 <em class='comment'> *  - Validate the some of passed arguments in the message.</em>
<a id='L40' name='L40' />  40 <em class='comment'> *  - Mapping of the task ID and cwd/file pointers.</em>
<a id='L41' name='L41' />  41 <em class='comment'> *</em>
<a id='L42' name='L42' />  42 <em class='comment'> * Note: All path string is translated to the full path before passing</em>
<a id='L43' name='L43' />  43 <em class='comment'> * it to the sys_* routines.</em>
<a id='L44' name='L44' />  44 <em class='comment'> */</em>
<a id='L45' name='L45' />  45 
<a id='L46' name='L46' />  46 <em class='sharp'>#include</em> &lt;<a href='267.html'>sys/prex.h</a>&gt;
<a id='L47' name='L47' />  47 <em class='sharp'>#include</em> &lt;<a href='249.html'>sys/capability.h</a>&gt;
<a id='L48' name='L48' />  48 <em class='sharp'>#include</em> &lt;<a href='264.html'>sys/param.h</a>&gt;
<a id='L49' name='L49' />  49 <em class='sharp'>#include</em> &lt;<a href='219.html'>ipc/fs.h</a>&gt;
<a id='L50' name='L50' />  50 <em class='sharp'>#include</em> &lt;<a href='../I/223.html'>ipc/proc.h</a>&gt;
<a id='L51' name='L51' />  51 <em class='sharp'>#include</em> &lt;<a href='../I/219.html'>ipc/exec.h</a>&gt;
<a id='L52' name='L52' />  52 <em class='sharp'>#include</em> &lt;<a href='../I/221.html'>ipc/ipc.h</a>&gt;
<a id='L53' name='L53' />  53 <em class='sharp'>#include</em> &lt;<a href='262.html'>sys/list.h</a>&gt;
<a id='L54' name='L54' />  54 <em class='sharp'>#include</em> &lt;<a href='271.html'>sys/stat.h</a>&gt;
<a id='L55' name='L55' />  55 <em class='sharp'>#include</em> &lt;<a href='279.html'>sys/vnode.h</a>&gt;
<a id='L56' name='L56' />  56 <em class='sharp'>#include</em> &lt;<a href='263.html'>sys/mount.h</a>&gt;
<a id='L57' name='L57' />  57 <em class='sharp'>#include</em> &lt;<a href='248.html'>sys/buf.h</a>&gt;
<a id='L58' name='L58' />  58 <em class='sharp'>#include</em> &lt;<a href='258.html'>sys/file.h</a>&gt;
<a id='L59' name='L59' />  59 
<a id='L60' name='L60' />  60 <em class='sharp'>#include</em> &lt;<a href='../I/211.html'>limits.h</a>&gt;
<a id='L61' name='L61' />  61 <em class='sharp'>#include</em> &lt;<a href='447.html'>unistd.h</a>&gt;
<a id='L62' name='L62' />  62 <em class='sharp'>#include</em> &lt;<a href='441.html'>stdio.h</a>&gt;
<a id='L63' name='L63' />  63 <em class='sharp'>#include</em> &lt;<a href='442.html'>stdlib.h</a>&gt;
<a id='L64' name='L64' />  64 <em class='sharp'>#include</em> &lt;<a href='443.html'>string.h</a>&gt;
<a id='L65' name='L65' />  65 <em class='sharp'>#include</em> &lt;<a href='../I/257.html'>errno.h</a>&gt;
<a id='L66' name='L66' />  66 <em class='sharp'>#include</em> &lt;<a href='../I/258.html'>fcntl.h</a>&gt;
<a id='L67' name='L67' />  67 <em class='sharp'>#include</em> &lt;<a href='../I/214.html'>signal.h</a>&gt;
<a id='L68' name='L68' />  68 
<a id='L69' name='L69' />  69 <em class='sharp'>#include</em> "<a href='905.html'>vfs.h</a>"
<a id='L70' name='L70' />  70 
<a id='L71' name='L71' />  71 <em class='sharp'>#ifdef</em> <a href='../Y/117.html' title='Multiple used in 9 places.'>DEBUG_VFS</a>
<a id='L72' name='L72' />  72 <strong class='reserved'>int</strong>     <a href='../Y/2310.html' title='Multiple used in 3 places.'>vfs_debug</a> = <a href='905.html#L58' title='Defined at 58 in usr/server/fs/vfs/vfs.h.'>VFSDB_FLAGS</a>;
<a id='L73' name='L73' />  73 <em class='sharp'>#endif</em>
<a id='L74' name='L74' />  74 
<a id='L75' name='L75' />  75 <em class='comment'>/*</em>
<a id='L76' name='L76' />  76 <em class='comment'> * Message mapping</em>
<a id='L77' name='L77' />  77 <em class='comment'> */</em>
<a id='L78' name='L78' />  78 <strong class='reserved'>struct</strong> <a href='../Y/1317.html' title='Multiple used in 12 places.'>msg_map</a> <em class='brace'>{</em>
<a id='L79' name='L79' />  79         <strong class='reserved'>int</strong>     <a href='../Y/540.html' title='Multiple used in 111 places.'>code</a>;
<a id='L80' name='L80' />  80         <strong class='reserved'>int</strong>     (*<a href='../Y/962.html' title='Multiple used in 37 places.'>func</a>)(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *);
<a id='L81' name='L81' />  81 <em class='brace'>}</em>;
<a id='L82' name='L82' />  82 
<a id='L83' name='L83' />  83 <em class='sharp'>#define</em> <a href='../R/607.html' title='Multiple refered from 49 places.'>MSGMAP</a>(<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a>, <a href='../Y/886.html' title='Multiple used in 23 places.'>fn</a>) <em class='brace'>{</em><a href='../Y/540.html' title='Multiple used in 111 places.'>code</a>, (<strong class='reserved'>int</strong> (*)(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *))<a href='../Y/886.html' title='Multiple used in 23 places.'>fn</a><em class='brace'>}</em>
<a id='L84' name='L84' />  84 
<a id='L85' name='L85' />  85 <em class='comment'>/* object for file service */</em>
<a id='L86' name='L86' />  86 <strong class='reserved'>static</strong> <a href='../D/3124.html' title='Multiple defined in 2 places.'>object_t</a> <a href='../Y/931.html' title='Multiple used in 13 places.'>fsobj</a>;
<a id='L87' name='L87' />  87 
<a id='L88' name='L88' />  88 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L89' name='L89' />  89 <a href='903.html#L976' title='Refered from 976 in usr/server/fs/vfs/main.c.'>fs_mount</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1305.html' title='Multiple used in 4 places.'>mount_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L90' name='L90' />  90 <em class='brace'>{</em>
<a id='L91' name='L91' />  91         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = 0;
<a id='L92' name='L92' />  92 
<a id='L93' name='L93' />  93         <em class='comment'>/* Check client's mount capability. */</em>
<a id='L94' name='L94' />  94         <strong class='reserved'>if</strong> (<a href='334.html#L362' title='Defined at 362 in sys/kern/task.c.'>task_chkcap</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2104.html' title='Multiple used in 10 places.'>t_taskid</a>, <a href='249.html#L51' title='Defined at 51 in include/sys/capability.h.'>CAP_DISKADMIN</a>) != 0)
<a id='L95' name='L95' />  95                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='256.html#L40' title='Defined at 40 in include/sys/errno.h.'>EPERM</a>;
<a id='L96' name='L96' />  96 
<a id='L97' name='L97' />  97         <strong class='reserved'>if</strong> (<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> == 0) <em class='brace'>{</em>
<a id='L98' name='L98' />  98                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='909.html#L89' title='Defined at 89 in usr/server/fs/vfs/vfs_mount.c.'>sys_mount</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/645.html' title='Multiple used in 285 places.'>dev</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/670.html' title='Multiple used in 87 places.'>dir</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/881.html' title='Multiple used in 302 places.'>flags</a>,
<a id='L99' name='L99' />  99                                 (<strong class='reserved'>void</strong> *)<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>);
<a id='L100' name='L100' /> 100         <em class='brace'>}</em>
<a id='L101' name='L101' /> 101 <em class='sharp'>#ifdef</em> <a href='../Y/93.html' title='Multiple used in 63 places.'>DEBUG</a>
<a id='L102' name='L102' /> 102         <strong class='reserved'>if</strong> (<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>)
<a id='L103' name='L103' /> 103                 <a href='747.html#L37' title='Defined at 37 in usr/lib/prex/gen/dprintf.c.'>dprintf</a>("VFS: mount failed!\n");
<a id='L104' name='L104' /> 104 <em class='sharp'>#endif</em>
<a id='L105' name='L105' /> 105         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L106' name='L106' /> 106 <em class='brace'>}</em>
<a id='L107' name='L107' /> 107 
<a id='L108' name='L108' /> 108 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L109' name='L109' /> 109 <a href='903.html#L977' title='Refered from 977 in usr/server/fs/vfs/main.c.'>fs_umount</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L110' name='L110' /> 110 <em class='brace'>{</em>
<a id='L111' name='L111' /> 111 
<a id='L112' name='L112' /> 112         <em class='comment'>/* Check mount capability. */</em>
<a id='L113' name='L113' /> 113         <strong class='reserved'>if</strong> (<a href='334.html#L362' title='Defined at 362 in sys/kern/task.c.'>task_chkcap</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2104.html' title='Multiple used in 10 places.'>t_taskid</a>, <a href='249.html#L51' title='Defined at 51 in include/sys/capability.h.'>CAP_DISKADMIN</a>) != 0)
<a id='L114' name='L114' /> 114                 <strong class='reserved'>return</strong> <a href='256.html#L40' title='Defined at 40 in include/sys/errno.h.'>EPERM</a>;
<a id='L115' name='L115' /> 115 
<a id='L116' name='L116' /> 116         <strong class='reserved'>return</strong> <a href='909.html#L212' title='Defined at 212 in usr/server/fs/vfs/vfs_mount.c.'>sys_umount</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>);
<a id='L117' name='L117' /> 117 <em class='brace'>}</em>
<a id='L118' name='L118' /> 118 
<a id='L119' name='L119' /> 119 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L120' name='L120' /> 120 <a href='903.html#L978' title='Refered from 978 in usr/server/fs/vfs/main.c.'>fs_sync</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L121' name='L121' /> 121 <em class='brace'>{</em>
<a id='L122' name='L122' /> 122 
<a id='L123' name='L123' /> 123         <strong class='reserved'>return</strong> <a href='909.html#L262' title='Defined at 262 in usr/server/fs/vfs/vfs_mount.c.'>sys_sync</a>();
<a id='L124' name='L124' /> 124 <em class='brace'>}</em>
<a id='L125' name='L125' /> 125 
<a id='L126' name='L126' /> 126 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L127' name='L127' /> 127 <a href='903.html#L979' title='Refered from 979 in usr/server/fs/vfs/main.c.'>fs_open</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1478.html' title='Multiple used in 9 places.'>open_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L128' name='L128' /> 128 <em class='brace'>{</em>
<a id='L129' name='L129' /> 129         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L130' name='L130' /> 130         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L131' name='L131' /> 131         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L132' name='L132' /> 132         <strong class='reserved'>int</strong> <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a>;
<a id='L133' name='L133' /> 133 
<a id='L134' name='L134' /> 134         <em class='comment'>/* Find empty slot for file descriptor. */</em>
<a id='L135' name='L135' /> 135         <strong class='reserved'>if</strong> ((<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1)
<a id='L136' name='L136' /> 136                 <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L137' name='L137' /> 137 
<a id='L138' name='L138' /> 138         <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> = 0;
<a id='L139' name='L139' /> 139         <strong class='reserved'>switch</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/881.html' title='Multiple used in 302 places.'>flags</a> &amp; <a href='257.html#L58' title='Defined at 58 in include/sys/fcntl.h.'>O_ACCMODE</a>) <em class='brace'>{</em>
<a id='L140' name='L140' /> 140         <strong class='reserved'>case</strong> <a href='257.html#L55' title='Defined at 55 in include/sys/fcntl.h.'>O_RDONLY</a>:
<a id='L141' name='L141' /> 141                 <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> = <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a>;
<a id='L142' name='L142' /> 142                 <strong class='reserved'>break</strong>;
<a id='L143' name='L143' /> 143         <strong class='reserved'>case</strong> <a href='257.html#L56' title='Defined at 56 in include/sys/fcntl.h.'>O_WRONLY</a>:
<a id='L144' name='L144' /> 144                 <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> = <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>;
<a id='L145' name='L145' /> 145                 <strong class='reserved'>break</strong>;
<a id='L146' name='L146' /> 146         <strong class='reserved'>case</strong> <a href='257.html#L57' title='Defined at 57 in include/sys/fcntl.h.'>O_RDWR</a>:
<a id='L147' name='L147' /> 147                 <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> = <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a> | <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>;
<a id='L148' name='L148' /> 148                 <strong class='reserved'>break</strong>;
<a id='L149' name='L149' /> 149         <em class='brace'>}</em>
<a id='L150' name='L150' /> 150         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L151' name='L151' /> 151                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L152' name='L152' /> 152 
<a id='L153' name='L153' /> 153         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L55' title='Defined at 55 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_open</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/881.html' title='Multiple used in 302 places.'>flags</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a>, &amp;<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>)) != 0)
<a id='L154' name='L154' /> 154                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L155' name='L155' /> 155 
<a id='L156' name='L156' /> 156         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L157' name='L157' /> 157         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2093.html' title='Multiple used in 5 places.'>t_nopens</a>++;
<a id='L158' name='L158' /> 158         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>;
<a id='L159' name='L159' /> 159         <strong class='reserved'>return</strong> 0;
<a id='L160' name='L160' /> 160 <em class='brace'>}</em>
<a id='L161' name='L161' /> 161 
<a id='L162' name='L162' /> 162 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L163' name='L163' /> 163 <a href='903.html#L980' title='Refered from 980 in usr/server/fs/vfs/main.c.'>fs_close</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L164' name='L164' /> 164 <em class='brace'>{</em>
<a id='L165' name='L165' /> 165         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L166' name='L166' /> 166         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L167' name='L167' /> 167 
<a id='L168' name='L168' /> 168         <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L169' name='L169' /> 169         <strong class='reserved'>if</strong> (<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> &gt;= <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>)
<a id='L170' name='L170' /> 170                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L171' name='L171' /> 171 
<a id='L172' name='L172' /> 172         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>];
<a id='L173' name='L173' /> 173         <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L174' name='L174' /> 174                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L175' name='L175' /> 175 
<a id='L176' name='L176' /> 176         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L148' title='Defined at 148 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_close</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>)) != 0)
<a id='L177' name='L177' /> 177                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L178' name='L178' /> 178 
<a id='L179' name='L179' /> 179         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L180' name='L180' /> 180         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2093.html' title='Multiple used in 5 places.'>t_nopens</a>--;
<a id='L181' name='L181' /> 181         <strong class='reserved'>return</strong> 0;
<a id='L182' name='L182' /> 182 <em class='brace'>}</em>
<a id='L183' name='L183' /> 183 
<a id='L184' name='L184' /> 184 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L185' name='L185' /> 185 <a href='903.html#L981' title='Refered from 981 in usr/server/fs/vfs/main.c.'>fs_mknod</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1478.html' title='Multiple used in 9 places.'>open_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L186' name='L186' /> 186 <em class='brace'>{</em>
<a id='L187' name='L187' /> 187         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L188' name='L188' /> 188         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L189' name='L189' /> 189 
<a id='L190' name='L190' /> 190         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L191' name='L191' /> 191                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L192' name='L192' /> 192 
<a id='L193' name='L193' /> 193         <strong class='reserved'>return</strong> <a href='911.html#L529' title='Defined at 529 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_mknod</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a>);
<a id='L194' name='L194' /> 194 <em class='brace'>}</em>
<a id='L195' name='L195' /> 195 
<a id='L196' name='L196' /> 196 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L197' name='L197' /> 197 <a href='903.html#L982' title='Refered from 982 in usr/server/fs/vfs/main.c.'>fs_lseek</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L198' name='L198' /> 198 <em class='brace'>{</em>
<a id='L199' name='L199' /> 199         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L200' name='L200' /> 200         <a href='277.html#L53' title='Defined at 53 in include/sys/types.h.'>off_t</a> <a href='../Y/1445.html' title='Multiple used in 60 places.'>offset</a>, <a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a>;
<a id='L201' name='L201' /> 201         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>, <a href='../Y/2242.html' title='Multiple used in 98 places.'>type</a>;
<a id='L202' name='L202' /> 202 
<a id='L203' name='L203' /> 203         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L204' name='L204' /> 204                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L205' name='L205' /> 205         <a href='../Y/1445.html' title='Multiple used in 60 places.'>offset</a> = (<a href='277.html#L53' title='Defined at 53 in include/sys/types.h.'>off_t</a>)<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1];
<a id='L206' name='L206' /> 206         <a href='../Y/2242.html' title='Multiple used in 98 places.'>type</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[2];
<a id='L207' name='L207' /> 207 
<a id='L208' name='L208' /> 208         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L219' title='Defined at 219 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_lseek</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1445.html' title='Multiple used in 60 places.'>offset</a>, <a href='../Y/2242.html' title='Multiple used in 98 places.'>type</a>, &amp;<a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a>);
<a id='L209' name='L209' /> 209         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = (<strong class='reserved'>int</strong>)<a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a>;
<a id='L210' name='L210' /> 210         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L211' name='L211' /> 211 <em class='brace'>}</em>
<a id='L212' name='L212' /> 212 
<a id='L213' name='L213' /> 213 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L214' name='L214' /> 214 <a href='903.html#L983' title='Refered from 983 in usr/server/fs/vfs/main.c.'>fs_read</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1084.html' title='Multiple used in 5 places.'>io_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L215' name='L215' /> 215 <em class='brace'>{</em>
<a id='L216' name='L216' /> 216         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L217' name='L217' /> 217         <strong class='reserved'>void</strong> *<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>;
<a id='L218' name='L218' /> 218         <a href='../D/3487.html' title='Multiple defined in 6 places.'>size_t</a> <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, <a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>;
<a id='L219' name='L219' /> 219         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L220' name='L220' /> 220 
<a id='L221' name='L221' /> 221         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L222' name='L222' /> 222                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L223' name='L223' /> 223         <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>;
<a id='L224' name='L224' /> 224         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/3820.html' title='Multiple defined in 2 places.'>vm_map</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>, <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, &amp;<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>)) != 0)
<a id='L225' name='L225' /> 225                 <strong class='reserved'>return</strong> <a href='256.html#L54' title='Defined at 54 in include/sys/errno.h.'>EFAULT</a>;
<a id='L226' name='L226' /> 226 
<a id='L227' name='L227' /> 227         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L175' title='Defined at 175 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_read</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>, <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, &amp;<a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>);
<a id='L228' name='L228' /> 228         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a> = <a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>;
<a id='L229' name='L229' /> 229         <a href='../D/3816.html' title='Multiple defined in 2 places.'>vm_free</a>(<a href='334.html#L217' title='Defined at 217 in sys/kern/task.c.'>task_self</a>(), <a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>);
<a id='L230' name='L230' /> 230         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L231' name='L231' /> 231 <em class='brace'>}</em>
<a id='L232' name='L232' /> 232 
<a id='L233' name='L233' /> 233 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L234' name='L234' /> 234 <a href='903.html#L984' title='Refered from 984 in usr/server/fs/vfs/main.c.'>fs_write</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1084.html' title='Multiple used in 5 places.'>io_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L235' name='L235' /> 235 <em class='brace'>{</em>
<a id='L236' name='L236' /> 236         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L237' name='L237' /> 237         <strong class='reserved'>void</strong> *<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>;
<a id='L238' name='L238' /> 238         <a href='../D/3487.html' title='Multiple defined in 6 places.'>size_t</a> <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, <a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>;
<a id='L239' name='L239' /> 239         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L240' name='L240' /> 240 
<a id='L241' name='L241' /> 241         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L242' name='L242' /> 242                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L243' name='L243' /> 243         <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>;
<a id='L244' name='L244' /> 244         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/3820.html' title='Multiple defined in 2 places.'>vm_map</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>, <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, &amp;<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>)) != 0)
<a id='L245' name='L245' /> 245                 <strong class='reserved'>return</strong> <a href='256.html#L54' title='Defined at 54 in include/sys/errno.h.'>EFAULT</a>;
<a id='L246' name='L246' /> 246 
<a id='L247' name='L247' /> 247         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L197' title='Defined at 197 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_write</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>, <a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a>, &amp;<a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>);
<a id='L248' name='L248' /> 248         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1959.html' title='Multiple used in 485 places.'>size</a> = <a href='../Y/467.html' title='Multiple used in 6 places.'>bytes</a>;
<a id='L249' name='L249' /> 249         <a href='../D/3816.html' title='Multiple defined in 2 places.'>vm_free</a>(<a href='334.html#L217' title='Defined at 217 in sys/kern/task.c.'>task_self</a>(), <a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>);
<a id='L250' name='L250' /> 250         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L251' name='L251' /> 251 <em class='brace'>}</em>
<a id='L252' name='L252' /> 252 
<a id='L253' name='L253' /> 253 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L254' name='L254' /> 254 <a href='903.html#L985' title='Refered from 985 in usr/server/fs/vfs/main.c.'>fs_ioctl</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1088.html' title='Multiple used in 3 places.'>ioctl_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L255' name='L255' /> 255 <em class='brace'>{</em>
<a id='L256' name='L256' /> 256         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L257' name='L257' /> 257 
<a id='L258' name='L258' /> 258         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L259' name='L259' /> 259                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L260' name='L260' /> 260 
<a id='L261' name='L261' /> 261         <strong class='reserved'>return</strong> <a href='911.html#L267' title='Defined at 267 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_ioctl</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1742.html' title='Multiple used in 7 places.'>request</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/457.html' title='Multiple used in 359 places.'>buf</a>);
<a id='L262' name='L262' /> 262 <em class='brace'>}</em>
<a id='L263' name='L263' /> 263 
<a id='L264' name='L264' /> 264 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L265' name='L265' /> 265 <a href='903.html#L986' title='Refered from 986 in usr/server/fs/vfs/main.c.'>fs_fsync</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L266' name='L266' /> 266 <em class='brace'>{</em>
<a id='L267' name='L267' /> 267         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L268' name='L268' /> 268 
<a id='L269' name='L269' /> 269         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L270' name='L270' /> 270                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L271' name='L271' /> 271 
<a id='L272' name='L272' /> 272         <strong class='reserved'>return</strong> <a href='911.html#L286' title='Defined at 286 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_fsync</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>);
<a id='L273' name='L273' /> 273 <em class='brace'>}</em>
<a id='L274' name='L274' /> 274 
<a id='L275' name='L275' /> 275 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L276' name='L276' /> 276 <a href='903.html#L987' title='Refered from 987 in usr/server/fs/vfs/main.c.'>fs_fstat</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/2022.html' title='Multiple used in 5 places.'>stat_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L277' name='L277' /> 277 <em class='brace'>{</em>
<a id='L278' name='L278' /> 278         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L279' name='L279' /> 279         <strong class='reserved'>struct</strong> <a href='../Y/2021.html' title='Multiple used in 43 places.'>stat</a> *<a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>;
<a id='L280' name='L280' /> 280         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L281' name='L281' /> 281 
<a id='L282' name='L282' /> 282         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L283' name='L283' /> 283                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L284' name='L284' /> 284 
<a id='L285' name='L285' /> 285         <a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a> = &amp;<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>;
<a id='L286' name='L286' /> 286         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L304' title='Defined at 304 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_fstat</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>);
<a id='L287' name='L287' /> 287         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L288' name='L288' /> 288 <em class='brace'>}</em>
<a id='L289' name='L289' /> 289 
<a id='L290' name='L290' /> 290 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L291' name='L291' /> 291 <a href='903.html#L988' title='Refered from 988 in usr/server/fs/vfs/main.c.'>fs_opendir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1478.html' title='Multiple used in 9 places.'>open_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L292' name='L292' /> 292 <em class='brace'>{</em>
<a id='L293' name='L293' /> 293         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L294' name='L294' /> 294         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L295' name='L295' /> 295         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L296' name='L296' /> 296 
<a id='L297' name='L297' /> 297         <em class='comment'>/* Find empty slot for file descriptor. */</em>
<a id='L298' name='L298' /> 298         <strong class='reserved'>if</strong> ((<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1)
<a id='L299' name='L299' /> 299                 <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L300' name='L300' /> 300 
<a id='L301' name='L301' /> 301         <em class='comment'>/* Get the mounted file system and node */</em>
<a id='L302' name='L302' /> 302         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L303' name='L303' /> 303                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L304' name='L304' /> 304 
<a id='L305' name='L305' /> 305         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L348' title='Defined at 348 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_opendir</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, &amp;<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>)) != 0)
<a id='L306' name='L306' /> 306                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L307' name='L307' /> 307         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L308' name='L308' /> 308         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>;
<a id='L309' name='L309' /> 309         <strong class='reserved'>return</strong> 0;
<a id='L310' name='L310' /> 310 <em class='brace'>}</em>
<a id='L311' name='L311' /> 311 
<a id='L312' name='L312' /> 312 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L313' name='L313' /> 313 <a href='903.html#L989' title='Refered from 989 in usr/server/fs/vfs/main.c.'>fs_closedir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L314' name='L314' /> 314 <em class='brace'>{</em>
<a id='L315' name='L315' /> 315         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L316' name='L316' /> 316         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L317' name='L317' /> 317 
<a id='L318' name='L318' /> 318         <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L319' name='L319' /> 319         <strong class='reserved'>if</strong> (<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> &gt;= <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>)
<a id='L320' name='L320' /> 320                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L321' name='L321' /> 321         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>];
<a id='L322' name='L322' /> 322         <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L323' name='L323' /> 323                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L324' name='L324' /> 324 
<a id='L325' name='L325' /> 325         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L373' title='Defined at 373 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_closedir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>)) != 0)
<a id='L326' name='L326' /> 326                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L327' name='L327' /> 327         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L328' name='L328' /> 328         <strong class='reserved'>return</strong> 0;
<a id='L329' name='L329' /> 329 <em class='brace'>}</em>
<a id='L330' name='L330' /> 330 
<a id='L331' name='L331' /> 331 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L332' name='L332' /> 332 <a href='903.html#L990' title='Refered from 990 in usr/server/fs/vfs/main.c.'>fs_readdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/672.html' title='Multiple used in 3 places.'>dir_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L333' name='L333' /> 333 <em class='brace'>{</em>
<a id='L334' name='L334' /> 334         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L335' name='L335' /> 335 
<a id='L336' name='L336' /> 336         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L337' name='L337' /> 337                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L338' name='L338' /> 338 
<a id='L339' name='L339' /> 339         <strong class='reserved'>return</strong> <a href='911.html#L392' title='Defined at 392 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_readdir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, &amp;<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/673.html' title='Multiple used in 39 places.'>dirent</a>);
<a id='L340' name='L340' /> 340 <em class='brace'>}</em>
<a id='L341' name='L341' /> 341 
<a id='L342' name='L342' /> 342 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L343' name='L343' /> 343 <a href='903.html#L991' title='Refered from 991 in usr/server/fs/vfs/main.c.'>fs_rewinddir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L344' name='L344' /> 344 <em class='brace'>{</em>
<a id='L345' name='L345' /> 345         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L346' name='L346' /> 346 
<a id='L347' name='L347' /> 347         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L348' name='L348' /> 348                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L349' name='L349' /> 349 
<a id='L350' name='L350' /> 350         <strong class='reserved'>return</strong> <a href='911.html#L413' title='Defined at 413 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_rewinddir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>);
<a id='L351' name='L351' /> 351 <em class='brace'>}</em>
<a id='L352' name='L352' /> 352 
<a id='L353' name='L353' /> 353 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L354' name='L354' /> 354 <a href='903.html#L992' title='Refered from 992 in usr/server/fs/vfs/main.c.'>fs_seekdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L355' name='L355' /> 355 <em class='brace'>{</em>
<a id='L356' name='L356' /> 356         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L357' name='L357' /> 357         <strong class='reserved'>long</strong> <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a>;
<a id='L358' name='L358' /> 358 
<a id='L359' name='L359' /> 359         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L360' name='L360' /> 360                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L361' name='L361' /> 361         <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1];
<a id='L362' name='L362' /> 362 
<a id='L363' name='L363' /> 363         <strong class='reserved'>return</strong> <a href='911.html#L429' title='Defined at 429 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_seekdir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a>);
<a id='L364' name='L364' /> 364 <em class='brace'>}</em>
<a id='L365' name='L365' /> 365 
<a id='L366' name='L366' /> 366 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L367' name='L367' /> 367 <a href='903.html#L993' title='Refered from 993 in usr/server/fs/vfs/main.c.'>fs_telldir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L368' name='L368' /> 368 <em class='brace'>{</em>
<a id='L369' name='L369' /> 369         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L370' name='L370' /> 370         <strong class='reserved'>long</strong> <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a>;
<a id='L371' name='L371' /> 371         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L372' name='L372' /> 372 
<a id='L373' name='L373' /> 373         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L374' name='L374' /> 374                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L375' name='L375' /> 375         <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1];
<a id='L376' name='L376' /> 376 
<a id='L377' name='L377' /> 377         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L445' title='Defined at 445 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_telldir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, &amp;<a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a>)) != 0)
<a id='L378' name='L378' /> 378                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L379' name='L379' /> 379         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = <a href='../Y/1210.html' title='Multiple used in 13 places.'>loc</a>;
<a id='L380' name='L380' /> 380         <strong class='reserved'>return</strong> 0;
<a id='L381' name='L381' /> 381 <em class='brace'>}</em>
<a id='L382' name='L382' /> 382 
<a id='L383' name='L383' /> 383 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L384' name='L384' /> 384 <a href='903.html#L994' title='Refered from 994 in usr/server/fs/vfs/main.c.'>fs_mkdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1478.html' title='Multiple used in 9 places.'>open_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L385' name='L385' /> 385 <em class='brace'>{</em>
<a id='L386' name='L386' /> 386         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L387' name='L387' /> 387         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L388' name='L388' /> 388 
<a id='L389' name='L389' /> 389         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L390' name='L390' /> 390                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L391' name='L391' /> 391 
<a id='L392' name='L392' /> 392         <strong class='reserved'>return</strong> <a href='911.html#L461' title='Defined at 461 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_mkdir</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a>);
<a id='L393' name='L393' /> 393 <em class='brace'>}</em>
<a id='L394' name='L394' /> 394 
<a id='L395' name='L395' /> 395 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L396' name='L396' /> 396 <a href='903.html#L995' title='Refered from 995 in usr/server/fs/vfs/main.c.'>fs_rmdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L397' name='L397' /> 397 <em class='brace'>{</em>
<a id='L398' name='L398' /> 398         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L399' name='L399' /> 399         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L400' name='L400' /> 400 
<a id='L401' name='L401' /> 401         <strong class='reserved'>if</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L402' name='L402' /> 402                 <strong class='reserved'>return</strong> <a href='256.html#L41' title='Defined at 41 in include/sys/errno.h.'>ENOENT</a>;
<a id='L403' name='L403' /> 403         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L404' name='L404' /> 404                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L405' name='L405' /> 405 
<a id='L406' name='L406' /> 406         <strong class='reserved'>return</strong> <a href='911.html#L492' title='Defined at 492 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_rmdir</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>);
<a id='L407' name='L407' /> 407 <em class='brace'>}</em>
<a id='L408' name='L408' /> 408 
<a id='L409' name='L409' /> 409 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L410' name='L410' /> 410 <a href='903.html#L996' title='Refered from 996 in usr/server/fs/vfs/main.c.'>fs_rename</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L411' name='L411' /> 411 <em class='brace'>{</em>
<a id='L412' name='L412' /> 412         <strong class='reserved'>char</strong> <a href='../Y/1980.html' title='Multiple used in 141 places.'>src</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L413' name='L413' /> 413         <strong class='reserved'>char</strong> <a href='../Y/644.html' title='Multiple used in 95 places.'>dest</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L414' name='L414' /> 414         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L415' name='L415' /> 415 
<a id='L416' name='L416' /> 416         <strong class='reserved'>if</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a> || <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1552.html' title='Multiple used in 5 places.'>path2</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L417' name='L417' /> 417                 <strong class='reserved'>return</strong> <a href='256.html#L41' title='Defined at 41 in include/sys/errno.h.'>ENOENT</a>;
<a id='L418' name='L418' /> 418 
<a id='L419' name='L419' /> 419         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a>, <a href='../Y/1980.html' title='Multiple used in 141 places.'>src</a>)) != 0)
<a id='L420' name='L420' /> 420                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L421' name='L421' /> 421 
<a id='L422' name='L422' /> 422         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1552.html' title='Multiple used in 5 places.'>path2</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/644.html' title='Multiple used in 95 places.'>dest</a>)) != 0)
<a id='L423' name='L423' /> 423                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L424' name='L424' /> 424 
<a id='L425' name='L425' /> 425         <strong class='reserved'>return</strong> <a href='911.html#L567' title='Defined at 567 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_rename</a>(<a href='../Y/1980.html' title='Multiple used in 141 places.'>src</a>, <a href='../Y/644.html' title='Multiple used in 95 places.'>dest</a>);
<a id='L426' name='L426' /> 426 <em class='brace'>}</em>
<a id='L427' name='L427' /> 427 
<a id='L428' name='L428' /> 428 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L429' name='L429' /> 429 <a href='903.html#L997' title='Refered from 997 in usr/server/fs/vfs/main.c.'>fs_chdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L430' name='L430' /> 430 <em class='brace'>{</em>
<a id='L431' name='L431' /> 431         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L432' name='L432' /> 432         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L433' name='L433' /> 433         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L434' name='L434' /> 434 
<a id='L435' name='L435' /> 435         <strong class='reserved'>if</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L436' name='L436' /> 436                 <strong class='reserved'>return</strong> <a href='256.html#L41' title='Defined at 41 in include/sys/errno.h.'>ENOENT</a>;
<a id='L437' name='L437' /> 437         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L438' name='L438' /> 438                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L439' name='L439' /> 439 
<a id='L440' name='L440' /> 440         <em class='comment'>/* Check if directory exits */</em>
<a id='L441' name='L441' /> 441         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L348' title='Defined at 348 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_opendir</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, &amp;<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>)) != 0)
<a id='L442' name='L442' /> 442                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L443' name='L443' /> 443         <strong class='reserved'>if</strong> (<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>)
<a id='L444' name='L444' /> 444                 <a href='911.html#L373' title='Defined at 373 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_closedir</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>);
<a id='L445' name='L445' /> 445         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a> = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L446' name='L446' /> 446         <a href='../D/3524.html' title='Multiple defined in 4 places.'>strlcpy</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <strong class='reserved'>sizeof</strong>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>));
<a id='L447' name='L447' /> 447         <strong class='reserved'>return</strong> 0;
<a id='L448' name='L448' /> 448 <em class='brace'>}</em>
<a id='L449' name='L449' /> 449 
<a id='L450' name='L450' /> 450 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L451' name='L451' /> 451 <a href='903.html#L1014' title='Refered from 1014 in usr/server/fs/vfs/main.c.'>fs_fchdir</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L452' name='L452' /> 452 <em class='brace'>{</em>
<a id='L453' name='L453' /> 453         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L454' name='L454' /> 454         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>;
<a id='L455' name='L455' /> 455 
<a id='L456' name='L456' /> 456         <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L457' name='L457' /> 457         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L458' name='L458' /> 458                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L459' name='L459' /> 459 
<a id='L460' name='L460' /> 460         <strong class='reserved'>if</strong> (<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>)
<a id='L461' name='L461' /> 461                 <a href='911.html#L373' title='Defined at 373 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_closedir</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>);
<a id='L462' name='L462' /> 462         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a> = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L463' name='L463' /> 463         <strong class='reserved'>return</strong> <a href='911.html#L744' title='Defined at 744 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_fchdir</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>);
<a id='L464' name='L464' /> 464 <em class='brace'>}</em>
<a id='L465' name='L465' /> 465 
<a id='L466' name='L466' /> 466 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L467' name='L467' /> 467 <a href='903.html#L998' title='Refered from 998 in usr/server/fs/vfs/main.c.'>fs_link</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L468' name='L468' /> 468 <em class='brace'>{</em>
<a id='L469' name='L469' /> 469         <em class='comment'>/* XXX */</em>
<a id='L470' name='L470' /> 470         <strong class='reserved'>return</strong> <a href='256.html#L40' title='Defined at 40 in include/sys/errno.h.'>EPERM</a>;
<a id='L471' name='L471' /> 471 <em class='brace'>}</em>
<a id='L472' name='L472' /> 472 
<a id='L473' name='L473' /> 473 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L474' name='L474' /> 474 <a href='903.html#L999' title='Refered from 999 in usr/server/fs/vfs/main.c.'>fs_unlink</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L475' name='L475' /> 475 <em class='brace'>{</em>
<a id='L476' name='L476' /> 476         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L477' name='L477' /> 477         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L478' name='L478' /> 478 
<a id='L479' name='L479' /> 479         <strong class='reserved'>if</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L480' name='L480' /> 480                 <strong class='reserved'>return</strong> <a href='256.html#L41' title='Defined at 41 in include/sys/errno.h.'>ENOENT</a>;
<a id='L481' name='L481' /> 481         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L482' name='L482' /> 482                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L483' name='L483' /> 483 
<a id='L484' name='L484' /> 484         <strong class='reserved'>return</strong> <a href='911.html#L655' title='Defined at 655 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_unlink</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>);
<a id='L485' name='L485' /> 485 <em class='brace'>}</em>
<a id='L486' name='L486' /> 486 
<a id='L487' name='L487' /> 487 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L488' name='L488' /> 488 <a href='903.html#L1000' title='Refered from 1000 in usr/server/fs/vfs/main.c.'>fs_stat</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/2022.html' title='Multiple used in 5 places.'>stat_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L489' name='L489' /> 489 <em class='brace'>{</em>
<a id='L490' name='L490' /> 490         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L491' name='L491' /> 491         <strong class='reserved'>struct</strong> <a href='../Y/2021.html' title='Multiple used in 43 places.'>stat</a> *<a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>;
<a id='L492' name='L492' /> 492         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L493' name='L493' /> 493 
<a id='L494' name='L494' /> 494         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, 0, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>);
<a id='L495' name='L495' /> 495         <strong class='reserved'>if</strong> (<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> == 0) <em class='brace'>{</em>
<a id='L496' name='L496' /> 496                 <a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a> = &amp;<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>;
<a id='L497' name='L497' /> 497                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L717' title='Defined at 717 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_stat</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1995.html' title='Multiple used in 44 places.'>st</a>);
<a id='L498' name='L498' /> 498         <em class='brace'>}</em>
<a id='L499' name='L499' /> 499         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L500' name='L500' /> 500 <em class='brace'>}</em>
<a id='L501' name='L501' /> 501 
<a id='L502' name='L502' /> 502 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L503' name='L503' /> 503 <a href='903.html#L1001' title='Refered from 1001 in usr/server/fs/vfs/main.c.'>fs_getcwd</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L504' name='L504' /> 504 <em class='brace'>{</em>
<a id='L505' name='L505' /> 505 
<a id='L506' name='L506' /> 506         <a href='../D/3524.html' title='Multiple defined in 4 places.'>strlcpy</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>, <strong class='reserved'>sizeof</strong>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>));
<a id='L507' name='L507' /> 507         <strong class='reserved'>return</strong> 0;
<a id='L508' name='L508' /> 508 <em class='brace'>}</em>
<a id='L509' name='L509' /> 509 
<a id='L510' name='L510' /> 510 <em class='comment'>/*</em>
<a id='L511' name='L511' /> 511 <em class='comment'> * Duplicate a file descriptor</em>
<a id='L512' name='L512' /> 512 <em class='comment'> */</em>
<a id='L513' name='L513' /> 513 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L514' name='L514' /> 514 <a href='903.html#L1002' title='Refered from 1002 in usr/server/fs/vfs/main.c.'>fs_dup</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L515' name='L515' /> 515 <em class='brace'>{</em>
<a id='L516' name='L516' /> 516         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L517' name='L517' /> 517         <strong class='reserved'>int</strong> <a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a>, <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L518' name='L518' /> 518 
<a id='L519' name='L519' /> 519         <a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L520' name='L520' /> 520         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L521' name='L521' /> 521                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L522' name='L522' /> 522 
<a id='L523' name='L523' /> 523         <em class='comment'>/* Find smallest empty slot as new fd. */</em>
<a id='L524' name='L524' /> 524         <strong class='reserved'>if</strong> ((<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1)
<a id='L525' name='L525' /> 525                 <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L526' name='L526' /> 526 
<a id='L527' name='L527' /> 527         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L528' name='L528' /> 528 
<a id='L529' name='L529' /> 529         <em class='comment'>/* Increment file reference */</em>
<a id='L530' name='L530' /> 530         <a href='913.html#L242' title='Defined at 242 in usr/server/fs/vfs/vfs_vnode.c.'>vref</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>);
<a id='L531' name='L531' /> 531         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/825.html' title='Multiple used in 10 places.'>f_count</a>++;
<a id='L532' name='L532' /> 532 
<a id='L533' name='L533' /> 533         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L534' name='L534' /> 534         <strong class='reserved'>return</strong> 0;
<a id='L535' name='L535' /> 535 <em class='brace'>}</em>
<a id='L536' name='L536' /> 536 
<a id='L537' name='L537' /> 537 <em class='comment'>/*</em>
<a id='L538' name='L538' /> 538 <em class='comment'> * Duplicate a file descriptor to a particular value.</em>
<a id='L539' name='L539' /> 539 <em class='comment'> */</em>
<a id='L540' name='L540' /> 540 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L541' name='L541' /> 541 <a href='903.html#L1003' title='Refered from 1003 in usr/server/fs/vfs/main.c.'>fs_dup2</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L542' name='L542' /> 542 <em class='brace'>{</em>
<a id='L543' name='L543' /> 543         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a>;
<a id='L544' name='L544' /> 544         <strong class='reserved'>int</strong> <a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a>, <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L545' name='L545' /> 545         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L546' name='L546' /> 546 
<a id='L547' name='L547' /> 547         <a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L548' name='L548' /> 548         <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1];
<a id='L549' name='L549' /> 549         <strong class='reserved'>if</strong> (<a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a> &gt;= <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a> || <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a> &gt;= <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>)
<a id='L550' name='L550' /> 550                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L551' name='L551' /> 551         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1452.html' title='Multiple used in 7 places.'>old_fd</a>];
<a id='L552' name='L552' /> 552         <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L553' name='L553' /> 553                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L554' name='L554' /> 554         <a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>];
<a id='L555' name='L555' /> 555         <strong class='reserved'>if</strong> (<a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a> != <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>) <em class='brace'>{</em>
<a id='L556' name='L556' /> 556                 <em class='comment'>/* Close previous file if it's opened. */</em>
<a id='L557' name='L557' /> 557                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L148' title='Defined at 148 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_close</a>(<a href='../Y/1491.html' title='Multiple used in 24 places.'>org</a>);
<a id='L558' name='L558' /> 558         <em class='brace'>}</em>
<a id='L559' name='L559' /> 559         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L560' name='L560' /> 560 
<a id='L561' name='L561' /> 561         <em class='comment'>/* Increment file reference */</em>
<a id='L562' name='L562' /> 562         <a href='913.html#L242' title='Defined at 242 in usr/server/fs/vfs/vfs_vnode.c.'>vref</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>);
<a id='L563' name='L563' /> 563         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/825.html' title='Multiple used in 10 places.'>f_count</a>++;
<a id='L564' name='L564' /> 564 
<a id='L565' name='L565' /> 565         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L566' name='L566' /> 566         <strong class='reserved'>return</strong> 0;
<a id='L567' name='L567' /> 567 <em class='brace'>}</em>
<a id='L568' name='L568' /> 568 
<a id='L569' name='L569' /> 569 <em class='comment'>/*</em>
<a id='L570' name='L570' /> 570 <em class='comment'> * The file control system call.</em>
<a id='L571' name='L571' /> 571 <em class='comment'> */</em>
<a id='L572' name='L572' /> 572 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L573' name='L573' /> 573 <a href='903.html#L1004' title='Refered from 1004 in usr/server/fs/vfs/main.c.'>fs_fcntl</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/852.html' title='Multiple used in 3 places.'>fcntl_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L574' name='L574' /> 574 <em class='brace'>{</em>
<a id='L575' name='L575' /> 575         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L576' name='L576' /> 576         <strong class='reserved'>int</strong> <a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a>, <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L577' name='L577' /> 577 
<a id='L578' name='L578' /> 578         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>)) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L579' name='L579' /> 579                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L580' name='L580' /> 580 
<a id='L581' name='L581' /> 581         <a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a>;
<a id='L582' name='L582' /> 582         <strong class='reserved'>switch</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/526.html' title='Multiple used in 109 places.'>cmd</a>) <em class='brace'>{</em>
<a id='L583' name='L583' /> 583         <strong class='reserved'>case</strong> <a href='257.html#L91' title='Defined at 91 in include/sys/fcntl.h.'>F_DUPFD</a>:
<a id='L584' name='L584' /> 584                 <strong class='reserved'>if</strong> (<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> &gt;= <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>)
<a id='L585' name='L585' /> 585                         <strong class='reserved'>return</strong> <a href='256.html#L62' title='Defined at 62 in include/sys/errno.h.'>EINVAL</a>;
<a id='L586' name='L586' /> 586                 <em class='comment'>/* Find smallest empty slot as new fd. */</em>
<a id='L587' name='L587' /> 587                 <strong class='reserved'>if</strong> ((<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1)
<a id='L588' name='L588' /> 588                         <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L589' name='L589' /> 589                 <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L590' name='L590' /> 590 
<a id='L591' name='L591' /> 591                 <em class='comment'>/* Increment file reference */</em>
<a id='L592' name='L592' /> 592                 <a href='913.html#L242' title='Defined at 242 in usr/server/fs/vfs/vfs_vnode.c.'>vref</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>);
<a id='L593' name='L593' /> 593                 <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/825.html' title='Multiple used in 10 places.'>f_count</a>++;
<a id='L594' name='L594' /> 594                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = <a href='../Y/1355.html' title='Multiple used in 14 places.'>new_fd</a>;
<a id='L595' name='L595' /> 595                 <strong class='reserved'>break</strong>;
<a id='L596' name='L596' /> 596         <strong class='reserved'>case</strong> <a href='257.html#L92' title='Defined at 92 in include/sys/fcntl.h.'>F_GETFD</a>:
<a id='L597' name='L597' /> 597                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/828.html' title='Multiple used in 13 places.'>f_flags</a> &amp; <a href='257.html#L103' title='Defined at 103 in include/sys/fcntl.h.'>FD_CLOEXEC</a>;
<a id='L598' name='L598' /> 598                 <strong class='reserved'>break</strong>;
<a id='L599' name='L599' /> 599         <strong class='reserved'>case</strong> <a href='257.html#L93' title='Defined at 93 in include/sys/fcntl.h.'>F_SETFD</a>:
<a id='L600' name='L600' /> 600                 <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/828.html' title='Multiple used in 13 places.'>f_flags</a> = (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/828.html' title='Multiple used in 13 places.'>f_flags</a> &amp; ~<a href='257.html#L103' title='Defined at 103 in include/sys/fcntl.h.'>FD_CLOEXEC</a>) |
<a id='L601' name='L601' /> 601                         (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> &amp; <a href='257.html#L103' title='Defined at 103 in include/sys/fcntl.h.'>FD_CLOEXEC</a>);
<a id='L602' name='L602' /> 602                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = 0;
<a id='L603' name='L603' /> 603                 <strong class='reserved'>break</strong>;
<a id='L604' name='L604' /> 604         <strong class='reserved'>case</strong> <a href='257.html#L94' title='Defined at 94 in include/sys/fcntl.h.'>F_GETFL</a>:
<a id='L605' name='L605' /> 605         <strong class='reserved'>case</strong> <a href='257.html#L95' title='Defined at 95 in include/sys/fcntl.h.'>F_SETFL</a>:
<a id='L606' name='L606' /> 606                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = -1;
<a id='L607' name='L607' /> 607                 <strong class='reserved'>break</strong>;
<a id='L608' name='L608' /> 608         <strong class='reserved'>default</strong>:
<a id='L609' name='L609' /> 609                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/375.html' title='Multiple used in 114 places.'>arg</a> = -1;
<a id='L610' name='L610' /> 610                 <strong class='reserved'>break</strong>;
<a id='L611' name='L611' /> 611         <em class='brace'>}</em>
<a id='L612' name='L612' /> 612         <strong class='reserved'>return</strong> 0;
<a id='L613' name='L613' /> 613 <em class='brace'>}</em>
<a id='L614' name='L614' /> 614 
<a id='L615' name='L615' /> 615 <em class='comment'>/*</em>
<a id='L616' name='L616' /> 616 <em class='comment'> * Check permission for file access</em>
<a id='L617' name='L617' /> 617 <em class='comment'> */</em>
<a id='L618' name='L618' /> 618 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L619' name='L619' /> 619 <a href='903.html#L1005' title='Refered from 1005 in usr/server/fs/vfs/main.c.'>fs_access</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L620' name='L620' /> 620 <em class='brace'>{</em>
<a id='L621' name='L621' /> 621         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L622' name='L622' /> 622         <strong class='reserved'>int</strong> <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a>, <a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = 0;
<a id='L623' name='L623' /> 623 
<a id='L624' name='L624' /> 624         <a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a> = <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L625' name='L625' /> 625         <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> = 0;
<a id='L626' name='L626' /> 626         <strong class='reserved'>if</strong> (<a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a> &amp; <a href='441.html#L169' title='Defined at 169 in usr/include/stdio.h.'>R_OK</a>)
<a id='L627' name='L627' /> 627                 <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> |= <a href='279.html#L96' title='Defined at 96 in include/sys/vnode.h.'>VREAD</a>;
<a id='L628' name='L628' /> 628         <strong class='reserved'>if</strong> (<a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a> &amp; <a href='441.html#L168' title='Defined at 168 in usr/include/stdio.h.'>W_OK</a>)
<a id='L629' name='L629' /> 629                 <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a> |= <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>;
<a id='L630' name='L630' /> 630 
<a id='L631' name='L631' /> 631         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/341.html' title='Multiple used in 45 places.'>acc</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L632' name='L632' /> 632                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L633' name='L633' /> 633 
<a id='L634' name='L634' /> 634         <strong class='reserved'>return</strong> <a href='911.html#L691' title='Defined at 691 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_access</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1294.html' title='Multiple used in 151 places.'>mode</a>);
<a id='L635' name='L635' /> 635 <em class='brace'>}</em>
<a id='L636' name='L636' /> 636 
<a id='L637' name='L637' /> 637 <em class='comment'>/*</em>
<a id='L638' name='L638' /> 638 <em class='comment'> * Copy parent's cwd &amp; file/directory descriptor to child's.</em>
<a id='L639' name='L639' /> 639 <em class='comment'> */</em>
<a id='L640' name='L640' /> 640 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L641' name='L641' /> 641 <a href='903.html#L1006' title='Refered from 1006 in usr/server/fs/vfs/main.c.'>fs_fork</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L642' name='L642' /> 642 <em class='brace'>{</em>
<a id='L643' name='L643' /> 643         <strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>;
<a id='L644' name='L644' /> 644         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L645' name='L645' /> 645         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>, <a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a>;
<a id='L646' name='L646' /> 646 
<a id='L647' name='L647' /> 647         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_fork\n"));
<a id='L648' name='L648' /> 648 
<a id='L649' name='L649' /> 649         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L99' title='Defined at 99 in usr/server/fs/vfs/vfs_task.c.'>task_alloc</a>((<a href='../D/3638.html' title='Multiple defined in 3 places.'>task_t</a>)<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0], &amp;<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>)) != 0)
<a id='L650' name='L650' /> 650                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L651' name='L651' /> 651 
<a id='L652' name='L652' /> 652         <em class='comment'>/*</em>
<a id='L653' name='L653' /> 653 <em class='comment'>         * Copy task related data</em>
<a id='L654' name='L654' /> 654 <em class='comment'>         */</em>
<a id='L655' name='L655' /> 655         <a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>;
<a id='L656' name='L656' /> 656         <a href='../D/3524.html' title='Multiple defined in 4 places.'>strlcpy</a>(<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>, <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>, <strong class='reserved'>sizeof</strong>(<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2086.html' title='Multiple used in 8 places.'>t_cwd</a>));
<a id='L657' name='L657' /> 657         <strong class='reserved'>for</strong> (<a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a> = 0; <a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a> &lt; <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>; <a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a>++) <em class='brace'>{</em>
<a id='L658' name='L658' /> 658                 <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a>];
<a id='L659' name='L659' /> 659                 <a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a>] = <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L660' name='L660' /> 660                 <em class='comment'>/*</em>
<a id='L661' name='L661' /> 661 <em class='comment'>                 * Increment file reference if it's</em>
<a id='L662' name='L662' /> 662 <em class='comment'>                 * already opened.</em>
<a id='L663' name='L663' /> 663 <em class='comment'>                 */</em>
<a id='L664' name='L664' /> 664                 <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> != <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>) <em class='brace'>{</em>
<a id='L665' name='L665' /> 665                         <a href='913.html#L242' title='Defined at 242 in usr/server/fs/vfs/vfs_vnode.c.'>vref</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>);
<a id='L666' name='L666' /> 666                         <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/825.html' title='Multiple used in 10 places.'>f_count</a>++;
<a id='L667' name='L667' /> 667                 <em class='brace'>}</em>
<a id='L668' name='L668' /> 668         <em class='brace'>}</em>
<a id='L669' name='L669' /> 669         <strong class='reserved'>if</strong> (<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>)
<a id='L670' name='L670' /> 670                 <a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>-&gt;<a href='../Y/825.html' title='Multiple used in 10 places.'>f_count</a>++;
<a id='L671' name='L671' /> 671         <em class='comment'>/* Increment cwd's reference count */</em>
<a id='L672' name='L672' /> 672         <strong class='reserved'>if</strong> (<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>)
<a id='L673' name='L673' /> 673                 <a href='913.html#L242' title='Defined at 242 in usr/server/fs/vfs/vfs_vnode.c.'>vref</a>(<a href='../Y/1372.html' title='Multiple used in 13 places.'>newtask</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>);
<a id='L674' name='L674' /> 674 
<a id='L675' name='L675' /> 675         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_fork-complete\n"));
<a id='L676' name='L676' /> 676         <strong class='reserved'>return</strong> 0;
<a id='L677' name='L677' /> 677 <em class='brace'>}</em>
<a id='L678' name='L678' /> 678 
<a id='L679' name='L679' /> 679 <em class='comment'>/*</em>
<a id='L680' name='L680' /> 680 <em class='comment'> * fs_exec() is called for POSIX exec().</em>
<a id='L681' name='L681' /> 681 <em class='comment'> * It closes all directory stream.</em>
<a id='L682' name='L682' /> 682 <em class='comment'> * File descriptor which is marked close-on-exec are also closed.</em>
<a id='L683' name='L683' /> 683 <em class='comment'> */</em>
<a id='L684' name='L684' /> 684 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L685' name='L685' /> 685 <a href='903.html#L1007' title='Refered from 1007 in usr/server/fs/vfs/main.c.'>fs_exec</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L686' name='L686' /> 686 <em class='brace'>{</em>
<a id='L687' name='L687' /> 687         <a href='../D/3638.html' title='Multiple defined in 3 places.'>task_t</a> <a href='../Y/1453.html' title='Multiple used in 3 places.'>old_id</a>, <a href='../Y/1357.html' title='Multiple used in 3 places.'>new_id</a>;
<a id='L688' name='L688' /> 688         <strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a>;
<a id='L689' name='L689' /> 689         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L690' name='L690' /> 690         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>;
<a id='L691' name='L691' /> 691 
<a id='L692' name='L692' /> 692         <a href='../Y/1453.html' title='Multiple used in 3 places.'>old_id</a> = (<a href='../D/3638.html' title='Multiple defined in 3 places.'>task_t</a>)<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0];
<a id='L693' name='L693' /> 693         <a href='../Y/1357.html' title='Multiple used in 3 places.'>new_id</a> = (<a href='../D/3638.html' title='Multiple defined in 3 places.'>task_t</a>)<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1];
<a id='L694' name='L694' /> 694 
<a id='L695' name='L695' /> 695         <strong class='reserved'>if</strong> (!(<a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a> = <a href='912.html#L70' title='Defined at 70 in usr/server/fs/vfs/vfs_task.c.'>task_lookup</a>(<a href='../Y/1453.html' title='Multiple used in 3 places.'>old_id</a>)))
<a id='L696' name='L696' /> 696                 <strong class='reserved'>return</strong> <a href='256.html#L62' title='Defined at 62 in include/sys/errno.h.'>EINVAL</a>;
<a id='L697' name='L697' /> 697 
<a id='L698' name='L698' /> 698         <em class='comment'>/* Update task id in the task. */</em>
<a id='L699' name='L699' /> 699         <a href='912.html#L140' title='Defined at 140 in usr/server/fs/vfs/vfs_task.c.'>task_setid</a>(<a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a>, <a href='../Y/1357.html' title='Multiple used in 3 places.'>new_id</a>);
<a id='L700' name='L700' /> 700 
<a id='L701' name='L701' /> 701         <em class='comment'>/* Close all directory descriptor */</em>
<a id='L702' name='L702' /> 702         <strong class='reserved'>for</strong> (<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = 0; <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> &lt; <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>; <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>++) <em class='brace'>{</em>
<a id='L703' name='L703' /> 703                 <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>];
<a id='L704' name='L704' /> 704                 <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>) <em class='brace'>{</em>
<a id='L705' name='L705' /> 705                         <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>-&gt;<a href='../Y/2289.html' title='Multiple used in 38 places.'>v_type</a> == <a href='../Y/232.html' title='Multiple used in 30 places.'>VDIR</a>) <em class='brace'>{</em>
<a id='L706' name='L706' /> 706                                 <a href='911.html#L148' title='Defined at 148 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_close</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>);
<a id='L707' name='L707' /> 707                                 <a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L708' name='L708' /> 708                         <em class='brace'>}</em>
<a id='L709' name='L709' /> 709 
<a id='L710' name='L710' /> 710                         <em class='comment'>/* XXX: need to check close-on-exec flag */</em>
<a id='L711' name='L711' /> 711                 <em class='brace'>}</em>
<a id='L712' name='L712' /> 712         <em class='brace'>}</em>
<a id='L713' name='L713' /> 713         <a href='912.html#L154' title='Defined at 154 in usr/server/fs/vfs/vfs_task.c.'>task_unlock</a>(<a href='../Y/2114.html' title='Multiple used in 40 places.'>target</a>);
<a id='L714' name='L714' /> 714         <strong class='reserved'>return</strong> 0;
<a id='L715' name='L715' /> 715 <em class='brace'>}</em>
<a id='L716' name='L716' /> 716 
<a id='L717' name='L717' /> 717 <em class='comment'>/*</em>
<a id='L718' name='L718' /> 718 <em class='comment'> * fs_exit() cleans up data for task's termination.</em>
<a id='L719' name='L719' /> 719 <em class='comment'> */</em>
<a id='L720' name='L720' /> 720 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L721' name='L721' /> 721 <a href='903.html#L1008' title='Refered from 1008 in usr/server/fs/vfs/main.c.'>fs_exit</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L722' name='L722' /> 722 <em class='brace'>{</em>
<a id='L723' name='L723' /> 723         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L724' name='L724' /> 724         <strong class='reserved'>int</strong> <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>;
<a id='L725' name='L725' /> 725 
<a id='L726' name='L726' /> 726         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_exit\n"));
<a id='L727' name='L727' /> 727 
<a id='L728' name='L728' /> 728         <em class='comment'>/*</em>
<a id='L729' name='L729' /> 729 <em class='comment'>         * Close all files opened by task.</em>
<a id='L730' name='L730' /> 730 <em class='comment'>         */</em>
<a id='L731' name='L731' /> 731         <strong class='reserved'>for</strong> (<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> = 0; <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a> &lt; <a href='273.html#L40' title='Defined at 40 in include/sys/syslimits.h.'>OPEN_MAX</a>; <a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>++) <em class='brace'>{</em>
<a id='L732' name='L732' /> 732                 <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/853.html' title='Multiple used in 210 places.'>fd</a>];
<a id='L733' name='L733' /> 733                 <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> != <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L734' name='L734' /> 734                         <a href='911.html#L148' title='Defined at 148 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_close</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>);
<a id='L735' name='L735' /> 735         <em class='brace'>}</em>
<a id='L736' name='L736' /> 736         <strong class='reserved'>if</strong> (<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>)
<a id='L737' name='L737' /> 737                 <a href='911.html#L148' title='Defined at 148 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_close</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2087.html' title='Multiple used in 14 places.'>t_cwdfp</a>);
<a id='L738' name='L738' /> 738         <a href='912.html#L125' title='Defined at 125 in usr/server/fs/vfs/vfs_task.c.'>task_free</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>);
<a id='L739' name='L739' /> 739         <strong class='reserved'>return</strong> 0;
<a id='L740' name='L740' /> 740 <em class='brace'>}</em>
<a id='L741' name='L741' /> 741 
<a id='L742' name='L742' /> 742 <em class='comment'>/*</em>
<a id='L743' name='L743' /> 743 <em class='comment'> * fs_register() is called by boot tasks.</em>
<a id='L744' name='L744' /> 744 <em class='comment'> * This can be called even when no fs is mounted.</em>
<a id='L745' name='L745' /> 745 <em class='comment'> */</em>
<a id='L746' name='L746' /> 746 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L747' name='L747' /> 747 <a href='../R/1919.html' title='Multiple refered from 3 places.'>fs_register</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L748' name='L748' /> 748 <em class='brace'>{</em>
<a id='L749' name='L749' /> 749         <strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2178.html' title='Multiple used in 155 places.'>tmp</a>;
<a id='L750' name='L750' /> 750         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L751' name='L751' /> 751 
<a id='L752' name='L752' /> 752         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_register\n"));
<a id='L753' name='L753' /> 753 
<a id='L754' name='L754' /> 754         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L99' title='Defined at 99 in usr/server/fs/vfs/vfs_task.c.'>task_alloc</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>, &amp;<a href='../Y/2178.html' title='Multiple used in 155 places.'>tmp</a>);
<a id='L755' name='L755' /> 755         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L756' name='L756' /> 756 <em class='brace'>}</em>
<a id='L757' name='L757' /> 757 
<a id='L758' name='L758' /> 758 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L759' name='L759' /> 759 <a href='903.html#L1010' title='Refered from 1010 in usr/server/fs/vfs/main.c.'>fs_pipe</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L760' name='L760' /> 760 <em class='brace'>{</em>
<a id='L761' name='L761' /> 761 <em class='sharp'>#ifdef</em> <a href='../Y/68.html' title='Multiple used in 2 places.'>CONFIG_FIFOFS</a>
<a id='L762' name='L762' /> 762         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L763' name='L763' /> 763         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/1762.html' title='Multiple used in 3 places.'>rfp</a>, <a href='../Y/2417.html' title='Multiple used in 3 places.'>wfp</a>;
<a id='L764' name='L764' /> 764         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>, <a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>, <a href='../Y/2416.html' title='Multiple used in 9 places.'>wfd</a>;
<a id='L765' name='L765' /> 765 
<a id='L766' name='L766' /> 766         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_pipe\n"));
<a id='L767' name='L767' /> 767 
<a id='L768' name='L768' /> 768         <strong class='reserved'>if</strong> ((<a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1)
<a id='L769' name='L769' /> 769                 <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L770' name='L770' /> 770         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>] = (<a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a>)1; <em class='comment'>/* temp */</em>
<a id='L771' name='L771' /> 771 
<a id='L772' name='L772' /> 772         <strong class='reserved'>if</strong> ((<a href='../Y/2416.html' title='Multiple used in 9 places.'>wfd</a> = <a href='912.html#L189' title='Defined at 189 in usr/server/fs/vfs/vfs_task.c.'>task_newfd</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) == -1) <em class='brace'>{</em>
<a id='L773' name='L773' /> 773                 <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L774' name='L774' /> 774                 <strong class='reserved'>return</strong> <a href='256.html#L64' title='Defined at 64 in include/sys/errno.h.'>EMFILE</a>;
<a id='L775' name='L775' /> 775         <em class='brace'>}</em>
<a id='L776' name='L776' /> 776         <a href='../D/3498.html' title='Multiple defined in 3 places.'>sprintf</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, "/mnt/fifo/pipe-%x-%d", (<a href='277.html#L45' title='Defined at 45 in include/sys/types.h.'>u_int</a>)<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2104.html' title='Multiple used in 10 places.'>t_taskid</a>, <a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>);
<a id='L777' name='L777' /> 777 
<a id='L778' name='L778' /> 778         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L529' title='Defined at 529 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_mknod</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='271.html#L82' title='Defined at 82 in include/sys/stat.h.'>S_IFIFO</a>)) != 0)
<a id='L779' name='L779' /> 779                 <strong class='reserved'>goto</strong> <a href='../Y/1502.html' title='Multiple used in 92 places.'>out</a>;
<a id='L780' name='L780' /> 780         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L55' title='Defined at 55 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_open</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='257.html#L55' title='Defined at 55 in include/sys/fcntl.h.'>O_RDONLY</a> | <a href='257.html#L67' title='Defined at 67 in include/sys/fcntl.h.'>O_NONBLOCK</a>, 0, &amp;<a href='../Y/1762.html' title='Multiple used in 3 places.'>rfp</a>)) != 0) <em class='brace'>{</em>
<a id='L781' name='L781' /> 781                 <strong class='reserved'>goto</strong> <a href='../Y/1502.html' title='Multiple used in 92 places.'>out</a>;
<a id='L782' name='L782' /> 782         <em class='brace'>}</em>
<a id='L783' name='L783' /> 783         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='911.html#L55' title='Defined at 55 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_open</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='257.html#L56' title='Defined at 56 in include/sys/fcntl.h.'>O_WRONLY</a> | <a href='257.html#L67' title='Defined at 67 in include/sys/fcntl.h.'>O_NONBLOCK</a>, 0, &amp;<a href='../Y/2417.html' title='Multiple used in 3 places.'>wfp</a>)) != 0) <em class='brace'>{</em>
<a id='L784' name='L784' /> 784                 <strong class='reserved'>goto</strong> <a href='../Y/1502.html' title='Multiple used in 92 places.'>out</a>;
<a id='L785' name='L785' /> 785         <em class='brace'>}</em>
<a id='L786' name='L786' /> 786         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>] = <a href='../Y/1762.html' title='Multiple used in 3 places.'>rfp</a>;
<a id='L787' name='L787' /> 787         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/2416.html' title='Multiple used in 9 places.'>wfd</a>] = <a href='../Y/2417.html' title='Multiple used in 3 places.'>wfp</a>;
<a id='L788' name='L788' /> 788         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2093.html' title='Multiple used in 5 places.'>t_nopens</a> += 2;
<a id='L789' name='L789' /> 789         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = <a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>;
<a id='L790' name='L790' /> 790         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1] = <a href='../Y/2416.html' title='Multiple used in 9 places.'>wfd</a>;
<a id='L791' name='L791' /> 791         <strong class='reserved'>return</strong> 0;
<a id='L792' name='L792' /> 792  <a href='../Y/1502.html' title='Multiple used in 92 places.'>out</a>:
<a id='L793' name='L793' /> 793         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/1760.html' title='Multiple used in 11 places.'>rfd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L794' name='L794' /> 794         <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>-&gt;<a href='../Y/2094.html' title='Multiple used in 27 places.'>t_ofile</a>[<a href='../Y/2416.html' title='Multiple used in 9 places.'>wfd</a>] = <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L795' name='L795' /> 795         <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L796' name='L796' /> 796 <em class='sharp'>#else</em>
<a id='L797' name='L797' /> 797         <strong class='reserved'>return</strong> <a href='256.html#L88' title='Defined at 88 in include/sys/errno.h.'>ENOSYS</a>;
<a id='L798' name='L798' /> 798 <em class='sharp'>#endif</em>
<a id='L799' name='L799' /> 799 <em class='brace'>}</em>
<a id='L800' name='L800' /> 800 
<a id='L801' name='L801' /> 801 <em class='comment'>/*</em>
<a id='L802' name='L802' /> 802 <em class='comment'> * Return if specified file is a tty</em>
<a id='L803' name='L803' /> 803 <em class='comment'> */</em>
<a id='L804' name='L804' /> 804 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L805' name='L805' /> 805 <a href='903.html#L1011' title='Refered from 1011 in usr/server/fs/vfs/main.c.'>fs_isatty</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L806' name='L806' /> 806 <em class='brace'>{</em>
<a id='L807' name='L807' /> 807         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L808' name='L808' /> 808         <strong class='reserved'>int</strong> <a href='../Y/1110.html' title='Multiple used in 3 places.'>istty</a> = 0;
<a id='L809' name='L809' /> 809 
<a id='L810' name='L810' /> 810         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L811' name='L811' /> 811                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L812' name='L812' /> 812 
<a id='L813' name='L813' /> 813         <strong class='reserved'>if</strong> (<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>-&gt;<a href='../Y/833.html' title='Multiple used in 23 places.'>f_vnode</a>-&gt;<a href='../Y/2279.html' title='Multiple used in 8 places.'>v_flags</a> &amp; <a href='279.html#L82' title='Defined at 82 in include/sys/vnode.h.'>VISTTY</a>)
<a id='L814' name='L814' /> 814                 <a href='../Y/1110.html' title='Multiple used in 3 places.'>istty</a> = 1;
<a id='L815' name='L815' /> 815         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0] = <a href='../Y/1110.html' title='Multiple used in 3 places.'>istty</a>;
<a id='L816' name='L816' /> 816         <strong class='reserved'>return</strong> 0;
<a id='L817' name='L817' /> 817 <em class='brace'>}</em>
<a id='L818' name='L818' /> 818 
<a id='L819' name='L819' /> 819 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L820' name='L820' /> 820 <a href='903.html#L1012' title='Refered from 1012 in usr/server/fs/vfs/main.c.'>fs_truncate</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1553.html' title='Multiple used in 18 places.'>path_msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L821' name='L821' /> 821 <em class='brace'>{</em>
<a id='L822' name='L822' /> 822         <strong class='reserved'>char</strong> <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>[<a href='273.html#L41' title='Defined at 41 in include/sys/syslimits.h.'>PATH_MAX</a>];
<a id='L823' name='L823' /> 823         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L824' name='L824' /> 824 
<a id='L825' name='L825' /> 825         <strong class='reserved'>if</strong> (<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L826' name='L826' /> 826                 <strong class='reserved'>return</strong> <a href='256.html#L41' title='Defined at 41 in include/sys/errno.h.'>ENOENT</a>;
<a id='L827' name='L827' /> 827         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='912.html#L224' title='Defined at 224 in usr/server/fs/vfs/vfs_task.c.'>task_conv</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='279.html#L97' title='Defined at 97 in include/sys/vnode.h.'>VWRITE</a>, <a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>)) != 0)
<a id='L828' name='L828' /> 828                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L829' name='L829' /> 829 
<a id='L830' name='L830' /> 830         <strong class='reserved'>return</strong> <a href='911.html#L732' title='Defined at 732 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_truncate</a>(<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0]);
<a id='L831' name='L831' /> 831 <em class='brace'>}</em>
<a id='L832' name='L832' /> 832 
<a id='L833' name='L833' /> 833 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L834' name='L834' /> 834 <a href='903.html#L1013' title='Refered from 1013 in usr/server/fs/vfs/main.c.'>fs_ftruncate</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L835' name='L835' /> 835 <em class='brace'>{</em>
<a id='L836' name='L836' /> 836         <a href='258.html#L47' title='Defined at 47 in include/sys/file.h.'>file_t</a> <a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>;
<a id='L837' name='L837' /> 837 
<a id='L838' name='L838' /> 838         <strong class='reserved'>if</strong> ((<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a> = <a href='912.html#L165' title='Defined at 165 in usr/server/fs/vfs/vfs_task.c.'>task_getfp</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[0])) == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L839' name='L839' /> 839                 <strong class='reserved'>return</strong> <a href='256.html#L48' title='Defined at 48 in include/sys/errno.h.'>EBADF</a>;
<a id='L840' name='L840' /> 840 
<a id='L841' name='L841' /> 841         <strong class='reserved'>return</strong> <a href='911.html#L738' title='Defined at 738 in usr/server/fs/vfs/vfs_syscalls.c.'>sys_ftruncate</a>(<a href='../Y/906.html' title='Multiple used in 689 places.'>fp</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/618.html' title='Multiple used in 193 places.'>data</a>[1]);
<a id='L842' name='L842' /> 842 <em class='brace'>}</em>
<a id='L843' name='L843' /> 843 
<a id='L844' name='L844' /> 844 <em class='comment'>/*</em>
<a id='L845' name='L845' /> 845 <em class='comment'> * Prepare for boot</em>
<a id='L846' name='L846' /> 846 <em class='comment'> */</em>
<a id='L847' name='L847' /> 847 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L848' name='L848' /> 848 <a href='../R/1889.html' title='Multiple refered from 2 places.'>fs_boot</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L849' name='L849' /> 849 <em class='brace'>{</em>
<a id='L850' name='L850' /> 850         <a href='../D/3124.html' title='Multiple defined in 2 places.'>object_t</a> <a href='../Y/808.html' title='Multiple used in 16 places.'>execobj</a>, <a href='../Y/1657.html' title='Multiple used in 15 places.'>procobj</a>;
<a id='L851' name='L851' /> 851         <strong class='reserved'>struct</strong> <a href='../Y/423.html' title='Multiple used in 7 places.'>bind_msg</a> <a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>;
<a id='L852' name='L852' /> 852         <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> <a href='../Y/1229.html' title='Multiple used in 513 places.'>m</a>;
<a id='L853' name='L853' /> 853 
<a id='L854' name='L854' /> 854         <em class='comment'>/* Check client's capability. */</em>
<a id='L855' name='L855' /> 855         <strong class='reserved'>if</strong> (<a href='334.html#L362' title='Defined at 362 in sys/kern/task.c.'>task_chkcap</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>, <a href='249.html#L48' title='Defined at 48 in include/sys/capability.h.'>CAP_PROTSERV</a>) != 0)
<a id='L856' name='L856' /> 856                 <strong class='reserved'>return</strong> <a href='256.html#L40' title='Defined at 40 in include/sys/errno.h.'>EPERM</a>;
<a id='L857' name='L857' /> 857 
<a id='L858' name='L858' /> 858         <em class='comment'>/*</em>
<a id='L859' name='L859' /> 859 <em class='comment'>         * Request exec server to bind an appropriate</em>
<a id='L860' name='L860' /> 860 <em class='comment'>         * capability for us.</em>
<a id='L861' name='L861' /> 861 <em class='comment'>         */</em>
<a id='L862' name='L862' /> 862         <strong class='reserved'>if</strong> (<a href='325.html#L140' title='Defined at 140 in sys/ipc/object.c.'>object_lookup</a>("!exec", &amp;<a href='../Y/808.html' title='Multiple used in 16 places.'>execobj</a>) != 0)
<a id='L863' name='L863' /> 863                 <a href='333.html#L208' title='Defined at 208 in sys/kern/system.c.'>sys_panic</a>("fs: no exec found");
<a id='L864' name='L864' /> 864         <a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>.<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> = <a href='218.html#L41' title='Defined at 41 in include/ipc/exec.h.'>EXEC_BINDCAP</a>;
<a id='L865' name='L865' /> 865         <a href='../D/3524.html' title='Multiple defined in 4 places.'>strlcpy</a>(<a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>.<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>, "/boot/fs", <strong class='reserved'>sizeof</strong>(<a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>.<a href='../Y/1551.html' title='Multiple used in 298 places.'>path</a>));
<a id='L866' name='L866' /> 866         <a href='324.html#L81' title='Defined at 81 in sys/ipc/msg.c.'>msg_send</a>(<a href='../Y/808.html' title='Multiple used in 16 places.'>execobj</a>, &amp;<a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>, <strong class='reserved'>sizeof</strong>(<a href='../Y/436.html' title='Multiple used in 12 places.'>bm</a>));
<a id='L867' name='L867' /> 867 
<a id='L868' name='L868' /> 868         <em class='comment'>/*</em>
<a id='L869' name='L869' /> 869 <em class='comment'>         * Notify to process server.</em>
<a id='L870' name='L870' /> 870 <em class='comment'>         */</em>
<a id='L871' name='L871' /> 871         <strong class='reserved'>if</strong> (<a href='325.html#L140' title='Defined at 140 in sys/ipc/object.c.'>object_lookup</a>("!proc", &amp;<a href='../Y/1657.html' title='Multiple used in 15 places.'>procobj</a>) != 0)
<a id='L872' name='L872' /> 872                 <a href='333.html#L208' title='Defined at 208 in sys/kern/system.c.'>sys_panic</a>("fs: no proc found");
<a id='L873' name='L873' /> 873         <a href='../Y/1229.html' title='Multiple used in 513 places.'>m</a>.<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> = <a href='222.html#L50' title='Defined at 50 in include/ipc/proc.h.'>PS_REGISTER</a>;
<a id='L874' name='L874' /> 874         <a href='324.html#L81' title='Defined at 81 in sys/ipc/msg.c.'>msg_send</a>(<a href='../Y/1657.html' title='Multiple used in 15 places.'>procobj</a>, &amp;<a href='../Y/1229.html' title='Multiple used in 513 places.'>m</a>, <strong class='reserved'>sizeof</strong>(<a href='../Y/1229.html' title='Multiple used in 513 places.'>m</a>));
<a id='L875' name='L875' /> 875 
<a id='L876' name='L876' /> 876         <strong class='reserved'>return</strong> 0;
<a id='L877' name='L877' /> 877 <em class='brace'>}</em>
<a id='L878' name='L878' /> 878 
<a id='L879' name='L879' /> 879 <em class='comment'>/*</em>
<a id='L880' name='L880' /> 880 <em class='comment'> * Prepare for shutdown</em>
<a id='L881' name='L881' /> 881 <em class='comment'> */</em>
<a id='L882' name='L882' /> 882 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L883' name='L883' /> 883 <a href='903.html#L1016' title='Refered from 1016 in usr/server/fs/vfs/main.c.'>fs_shutdown</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L884' name='L884' /> 884 <em class='brace'>{</em>
<a id='L885' name='L885' /> 885 
<a id='L886' name='L886' /> 886         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("fs_shutdown\n"));
<a id='L887' name='L887' /> 887         <strong class='reserved'>return</strong> 0;
<a id='L888' name='L888' /> 888 <em class='brace'>}</em>
<a id='L889' name='L889' /> 889 
<a id='L890' name='L890' /> 890 <strong class='reserved'>int</strong>
<a id='L891' name='L891' /> 891 <a href='../R/1913.html' title='Multiple refered from 2 places.'>fs_noop</a>(<strong class='reserved'>void</strong>)
<a id='L892' name='L892' /> 892 <em class='brace'>{</em>
<a id='L893' name='L893' /> 893         <strong class='reserved'>return</strong> 0;
<a id='L894' name='L894' /> 894 <em class='brace'>}</em>
<a id='L895' name='L895' /> 895 
<a id='L896' name='L896' /> 896 <em class='sharp'>#ifdef</em> <a href='../Y/117.html' title='Multiple used in 9 places.'>DEBUG_VFS</a>
<a id='L897' name='L897' /> 897 <em class='comment'>/*</em>
<a id='L898' name='L898' /> 898 <em class='comment'> * Dump internal data.</em>
<a id='L899' name='L899' /> 899 <em class='comment'> */</em>
<a id='L900' name='L900' /> 900 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L901' name='L901' /> 901 <a href='903.html#L1018' title='Refered from 1018 in usr/server/fs/vfs/main.c.'>fs_debug</a>(<strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>)
<a id='L902' name='L902' /> 902 <em class='brace'>{</em>
<a id='L903' name='L903' /> 903 
<a id='L904' name='L904' /> 904         <a href='747.html#L37' title='Defined at 37 in usr/lib/prex/gen/dprintf.c.'>dprintf</a>("&lt;File System Server&gt;\n");
<a id='L905' name='L905' /> 905         <a href='912.html#L294' title='Defined at 294 in usr/server/fs/vfs/vfs_task.c.'>task_dump</a>();
<a id='L906' name='L906' /> 906         <a href='913.html#L423' title='Defined at 423 in usr/server/fs/vfs/vfs_vnode.c.'>vnode_dump</a>();
<a id='L907' name='L907' /> 907         <a href='909.html#L382' title='Defined at 382 in usr/server/fs/vfs/vfs_mount.c.'>mount_dump</a>();
<a id='L908' name='L908' /> 908         <strong class='reserved'>return</strong> 0;
<a id='L909' name='L909' /> 909 <em class='brace'>}</em>
<a id='L910' name='L910' /> 910 <em class='sharp'>#endif</em>
<a id='L911' name='L911' /> 911 
<a id='L912' name='L912' /> 912 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L913' name='L913' /> 913 <a href='903.html#L1108' title='Refered from 1108 in usr/server/fs/vfs/main.c.'>vfs_init</a>(<strong class='reserved'>void</strong>)
<a id='L914' name='L914' /> 914 <em class='brace'>{</em>
<a id='L915' name='L915' /> 915         <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../Y/2324.html' title='Multiple used in 9 places.'>vfssw</a> *<a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>;
<a id='L916' name='L916' /> 916         <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>;
<a id='L917' name='L917' /> 917 
<a id='L918' name='L918' /> 918         <em class='comment'>/*</em>
<a id='L919' name='L919' /> 919 <em class='comment'>         * Initialize VFS core.</em>
<a id='L920' name='L920' /> 920 <em class='comment'>         */</em>
<a id='L921' name='L921' /> 921         <a href='../D/3627.html' title='Multiple defined in 2 places.'>task_init</a>();
<a id='L922' name='L922' /> 922         <a href='906.html#L369' title='Defined at 369 in usr/server/fs/vfs/vfs_bio.c.'>bio_init</a>();
<a id='L923' name='L923' /> 923         <a href='913.html#L474' title='Defined at 474 in usr/server/fs/vfs/vfs_vnode.c.'>vnode_init</a>();
<a id='L924' name='L924' /> 924 
<a id='L925' name='L925' /> 925         <em class='comment'>/*</em>
<a id='L926' name='L926' /> 926 <em class='comment'>         * Initialize each file system.</em>
<a id='L927' name='L927' /> 927 <em class='comment'>         */</em>
<a id='L928' name='L928' /> 928         <strong class='reserved'>for</strong> (<a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a> = <a href='../Y/2324.html' title='Multiple used in 9 places.'>vfssw</a>; <a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>-&gt;<a href='../Y/2391.html' title='Multiple used in 6 places.'>vs_name</a>; <a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>++) <em class='brace'>{</em>
<a id='L929' name='L929' /> 929                 <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("VFS: initializing %s\n",
<a id='L930' name='L930' /> 930                                      <a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>-&gt;<a href='../Y/2391.html' title='Multiple used in 6 places.'>vs_name</a>));
<a id='L931' name='L931' /> 931                 <a href='../Y/924.html' title='Multiple used in 18 places.'>fs</a>-&gt;<a href='../Y/2390.html' title='Multiple used in 2 places.'>vs_init</a>();
<a id='L932' name='L932' /> 932         <em class='brace'>}</em>
<a id='L933' name='L933' /> 933 
<a id='L934' name='L934' /> 934         <em class='comment'>/*</em>
<a id='L935' name='L935' /> 935 <em class='comment'>         * Create task data for ourselves.</em>
<a id='L936' name='L936' /> 936 <em class='comment'>         */</em>
<a id='L937' name='L937' /> 937         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>.<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> = <a href='334.html#L217' title='Defined at 217 in sys/kern/task.c.'>task_self</a>();
<a id='L938' name='L938' /> 938         <a href='903.html#L747' title='Defined at 747 in usr/server/fs/vfs/main.c.'>fs_register</a>(<a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>);
<a id='L939' name='L939' /> 939 <em class='brace'>}</em>
<a id='L940' name='L940' /> 940 
<a id='L941' name='L941' /> 941 <em class='comment'>/*</em>
<a id='L942' name='L942' /> 942 <em class='comment'> * Run specified routine as a thread.</em>
<a id='L943' name='L943' /> 943 <em class='comment'> */</em>
<a id='L944' name='L944' /> 944 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L945' name='L945' /> 945 <a href='../R/2445.html' title='Multiple refered from 2 places.'>run_thread</a>(<strong class='reserved'>void</strong> (*<a href='../Y/758.html' title='Multiple used in 62 places.'>entry</a>)(<strong class='reserved'>void</strong>))
<a id='L946' name='L946' /> 946 <em class='brace'>{</em>
<a id='L947' name='L947' /> 947         <a href='../D/3638.html' title='Multiple defined in 3 places.'>task_t</a> <a href='../Y/1881.html' title='Multiple used in 99 places.'>self</a>;
<a id='L948' name='L948' /> 948         <a href='../D/3688.html' title='Multiple defined in 3 places.'>thread_t</a> <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>;
<a id='L949' name='L949' /> 949         <strong class='reserved'>void</strong> *<a href='../Y/2016.html' title='Multiple used in 92 places.'>stack</a>, *<a href='../Y/1970.html' title='Multiple used in 233 places.'>sp</a>;
<a id='L950' name='L950' /> 950         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L951' name='L951' /> 951 
<a id='L952' name='L952' /> 952         <a href='../Y/1881.html' title='Multiple used in 99 places.'>self</a> = <a href='334.html#L217' title='Defined at 217 in sys/kern/task.c.'>task_self</a>();
<a id='L953' name='L953' /> 953         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='335.html#L65' title='Defined at 65 in sys/kern/thread.c.'>thread_create</a>(<a href='../Y/1881.html' title='Multiple used in 99 places.'>self</a>, &amp;<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>)) != 0)
<a id='L954' name='L954' /> 954                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L955' name='L955' /> 955         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/3812.html' title='Multiple defined in 2 places.'>vm_allocate</a>(<a href='../Y/1881.html' title='Multiple used in 99 places.'>self</a>, &amp;<a href='../Y/2016.html' title='Multiple used in 92 places.'>stack</a>, <a href='264.html#L119' title='Defined at 119 in include/sys/param.h.'>DFLSTKSZ</a>, 1)) != 0)
<a id='L956' name='L956' /> 956                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L957' name='L957' /> 957 
<a id='L958' name='L958' /> 958         <a href='../Y/1970.html' title='Multiple used in 233 places.'>sp</a> = (<strong class='reserved'>void</strong> *)((<a href='../D/3758.html' title='Multiple defined in 2 places.'>u_long</a>)<a href='../Y/2016.html' title='Multiple used in 92 places.'>stack</a> + <a href='264.html#L119' title='Defined at 119 in include/sys/param.h.'>DFLSTKSZ</a> - <strong class='reserved'>sizeof</strong>(<a href='../D/3758.html' title='Multiple defined in 2 places.'>u_long</a>) * 3);
<a id='L959' name='L959' /> 959         <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='335.html#L167' title='Defined at 167 in sys/kern/thread.c.'>thread_load</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/758.html' title='Multiple used in 62 places.'>entry</a>, <a href='../Y/1970.html' title='Multiple used in 233 places.'>sp</a>)) != 0)
<a id='L960' name='L960' /> 960                 <strong class='reserved'>return</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L961' name='L961' /> 961 
<a id='L962' name='L962' /> 962         <strong class='reserved'>return</strong> <a href='335.html#L269' title='Defined at 269 in sys/kern/thread.c.'>thread_resume</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>);
<a id='L963' name='L963' /> 963 <em class='brace'>}</em>
<a id='L964' name='L964' /> 964 
<a id='L965' name='L965' /> 965 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L966' name='L966' /> 966 <a href='../R/1741.html' title='Multiple refered from 4 places.'>exception_handler</a>(<strong class='reserved'>int</strong> <a href='../Y/1943.html' title='Multiple used in 77 places.'>sig</a>)
<a id='L967' name='L967' /> 967 <em class='brace'>{</em>
<a id='L968' name='L968' /> 968 
<a id='L969' name='L969' /> 969         <a href='328.html#L360' title='Defined at 360 in sys/kern/exception.c.'>exception_return</a>();
<a id='L970' name='L970' /> 970 <em class='brace'>}</em>
<a id='L971' name='L971' /> 971 
<a id='L972' name='L972' /> 972 <em class='comment'>/*</em>
<a id='L973' name='L973' /> 973 <em class='comment'> * Message mapping</em>
<a id='L974' name='L974' /> 974 <em class='comment'> */</em>
<a id='L975' name='L975' /> 975 <strong class='reserved'>static</strong> <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../Y/1317.html' title='Multiple used in 12 places.'>msg_map</a> <a href='../Y/929.html' title='Multiple used in 2 places.'>fsmsg_map</a>[] = <em class='brace'>{</em>
<a id='L976' name='L976' /> 976         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L45' title='Defined at 45 in include/ipc/fs.h.'>FS_MOUNT</a>,       <a href='903.html#L89' title='Defined at 89 in usr/server/fs/vfs/main.c.'>fs_mount</a> ),
<a id='L977' name='L977' /> 977         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L46' title='Defined at 46 in include/ipc/fs.h.'>FS_UMOUNT</a>,      <a href='903.html#L109' title='Defined at 109 in usr/server/fs/vfs/main.c.'>fs_umount</a> ),
<a id='L978' name='L978' /> 978         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L47' title='Defined at 47 in include/ipc/fs.h.'>FS_SYNC</a>,        <a href='903.html#L120' title='Defined at 120 in usr/server/fs/vfs/main.c.'>fs_sync</a> ),
<a id='L979' name='L979' /> 979         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L48' title='Defined at 48 in include/ipc/fs.h.'>FS_OPEN</a>,        <a href='903.html#L127' title='Defined at 127 in usr/server/fs/vfs/main.c.'>fs_open</a> ),
<a id='L980' name='L980' /> 980         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L49' title='Defined at 49 in include/ipc/fs.h.'>FS_CLOSE</a>,       <a href='903.html#L163' title='Defined at 163 in usr/server/fs/vfs/main.c.'>fs_close</a> ),
<a id='L981' name='L981' /> 981         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L50' title='Defined at 50 in include/ipc/fs.h.'>FS_MKNOD</a>,       <a href='903.html#L185' title='Defined at 185 in usr/server/fs/vfs/main.c.'>fs_mknod</a> ),
<a id='L982' name='L982' /> 982         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L51' title='Defined at 51 in include/ipc/fs.h.'>FS_LSEEK</a>,       <a href='903.html#L197' title='Defined at 197 in usr/server/fs/vfs/main.c.'>fs_lseek</a> ),
<a id='L983' name='L983' /> 983         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L52' title='Defined at 52 in include/ipc/fs.h.'>FS_READ</a>,        <a href='903.html#L214' title='Defined at 214 in usr/server/fs/vfs/main.c.'>fs_read</a> ),
<a id='L984' name='L984' /> 984         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L53' title='Defined at 53 in include/ipc/fs.h.'>FS_WRITE</a>,       <a href='903.html#L234' title='Defined at 234 in usr/server/fs/vfs/main.c.'>fs_write</a> ),
<a id='L985' name='L985' /> 985         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L54' title='Defined at 54 in include/ipc/fs.h.'>FS_IOCTL</a>,       <a href='903.html#L254' title='Defined at 254 in usr/server/fs/vfs/main.c.'>fs_ioctl</a> ),
<a id='L986' name='L986' /> 986         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L55' title='Defined at 55 in include/ipc/fs.h.'>FS_FSYNC</a>,       <a href='903.html#L265' title='Defined at 265 in usr/server/fs/vfs/main.c.'>fs_fsync</a> ),
<a id='L987' name='L987' /> 987         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L56' title='Defined at 56 in include/ipc/fs.h.'>FS_FSTAT</a>,       <a href='903.html#L276' title='Defined at 276 in usr/server/fs/vfs/main.c.'>fs_fstat</a> ),
<a id='L988' name='L988' /> 988         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L57' title='Defined at 57 in include/ipc/fs.h.'>FS_OPENDIR</a>,     <a href='903.html#L291' title='Defined at 291 in usr/server/fs/vfs/main.c.'>fs_opendir</a> ),
<a id='L989' name='L989' /> 989         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L58' title='Defined at 58 in include/ipc/fs.h.'>FS_CLOSEDIR</a>,    <a href='903.html#L313' title='Defined at 313 in usr/server/fs/vfs/main.c.'>fs_closedir</a> ),
<a id='L990' name='L990' /> 990         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L59' title='Defined at 59 in include/ipc/fs.h.'>FS_READDIR</a>,     <a href='903.html#L332' title='Defined at 332 in usr/server/fs/vfs/main.c.'>fs_readdir</a> ),
<a id='L991' name='L991' /> 991         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L60' title='Defined at 60 in include/ipc/fs.h.'>FS_REWINDDIR</a>,   <a href='903.html#L343' title='Defined at 343 in usr/server/fs/vfs/main.c.'>fs_rewinddir</a> ),
<a id='L992' name='L992' /> 992         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L61' title='Defined at 61 in include/ipc/fs.h.'>FS_SEEKDIR</a>,     <a href='903.html#L354' title='Defined at 354 in usr/server/fs/vfs/main.c.'>fs_seekdir</a> ),
<a id='L993' name='L993' /> 993         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L62' title='Defined at 62 in include/ipc/fs.h.'>FS_TELLDIR</a>,     <a href='903.html#L367' title='Defined at 367 in usr/server/fs/vfs/main.c.'>fs_telldir</a> ),
<a id='L994' name='L994' /> 994         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L63' title='Defined at 63 in include/ipc/fs.h.'>FS_MKDIR</a>,       <a href='903.html#L384' title='Defined at 384 in usr/server/fs/vfs/main.c.'>fs_mkdir</a> ),
<a id='L995' name='L995' /> 995         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L64' title='Defined at 64 in include/ipc/fs.h.'>FS_RMDIR</a>,       <a href='903.html#L396' title='Defined at 396 in usr/server/fs/vfs/main.c.'>fs_rmdir</a> ),
<a id='L996' name='L996' /> 996         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L65' title='Defined at 65 in include/ipc/fs.h.'>FS_RENAME</a>,      <a href='903.html#L410' title='Defined at 410 in usr/server/fs/vfs/main.c.'>fs_rename</a> ),
<a id='L997' name='L997' /> 997         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L66' title='Defined at 66 in include/ipc/fs.h.'>FS_CHDIR</a>,       <a href='903.html#L429' title='Defined at 429 in usr/server/fs/vfs/main.c.'>fs_chdir</a> ),
<a id='L998' name='L998' /> 998         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L67' title='Defined at 67 in include/ipc/fs.h.'>FS_LINK</a>,        <a href='903.html#L467' title='Defined at 467 in usr/server/fs/vfs/main.c.'>fs_link</a> ),
<a id='L999' name='L999' /> 999         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L68' title='Defined at 68 in include/ipc/fs.h.'>FS_UNLINK</a>,      <a href='903.html#L474' title='Defined at 474 in usr/server/fs/vfs/main.c.'>fs_unlink</a> ),
<a id='L1000' name='L1000' />1000         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L69' title='Defined at 69 in include/ipc/fs.h.'>FS_STAT</a>,        <a href='903.html#L488' title='Defined at 488 in usr/server/fs/vfs/main.c.'>fs_stat</a> ),
<a id='L1001' name='L1001' />1001         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L70' title='Defined at 70 in include/ipc/fs.h.'>FS_GETCWD</a>,      <a href='903.html#L503' title='Defined at 503 in usr/server/fs/vfs/main.c.'>fs_getcwd</a> ),
<a id='L1002' name='L1002' />1002         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L71' title='Defined at 71 in include/ipc/fs.h.'>FS_DUP</a>,         <a href='903.html#L514' title='Defined at 514 in usr/server/fs/vfs/main.c.'>fs_dup</a> ),
<a id='L1003' name='L1003' />1003         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L72' title='Defined at 72 in include/ipc/fs.h.'>FS_DUP2</a>,        <a href='903.html#L541' title='Defined at 541 in usr/server/fs/vfs/main.c.'>fs_dup2</a> ),
<a id='L1004' name='L1004' />1004         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L73' title='Defined at 73 in include/ipc/fs.h.'>FS_FCNTL</a>,       <a href='903.html#L573' title='Defined at 573 in usr/server/fs/vfs/main.c.'>fs_fcntl</a> ),
<a id='L1005' name='L1005' />1005         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L74' title='Defined at 74 in include/ipc/fs.h.'>FS_ACCESS</a>,      <a href='903.html#L619' title='Defined at 619 in usr/server/fs/vfs/main.c.'>fs_access</a> ),
<a id='L1006' name='L1006' />1006         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L75' title='Defined at 75 in include/ipc/fs.h.'>FS_FORK</a>,        <a href='903.html#L641' title='Defined at 641 in usr/server/fs/vfs/main.c.'>fs_fork</a> ),
<a id='L1007' name='L1007' />1007         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L76' title='Defined at 76 in include/ipc/fs.h.'>FS_EXEC</a>,        <a href='903.html#L685' title='Defined at 685 in usr/server/fs/vfs/main.c.'>fs_exec</a> ),
<a id='L1008' name='L1008' />1008         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L77' title='Defined at 77 in include/ipc/fs.h.'>FS_EXIT</a>,        <a href='903.html#L721' title='Defined at 721 in usr/server/fs/vfs/main.c.'>fs_exit</a> ),
<a id='L1009' name='L1009' />1009         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L78' title='Defined at 78 in include/ipc/fs.h.'>FS_REGISTER</a>,    <a href='903.html#L747' title='Defined at 747 in usr/server/fs/vfs/main.c.'>fs_register</a> ),
<a id='L1010' name='L1010' />1010         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L79' title='Defined at 79 in include/ipc/fs.h.'>FS_PIPE</a>,        <a href='903.html#L759' title='Defined at 759 in usr/server/fs/vfs/main.c.'>fs_pipe</a> ),
<a id='L1011' name='L1011' />1011         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L80' title='Defined at 80 in include/ipc/fs.h.'>FS_ISATTY</a>,      <a href='903.html#L805' title='Defined at 805 in usr/server/fs/vfs/main.c.'>fs_isatty</a> ),
<a id='L1012' name='L1012' />1012         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L81' title='Defined at 81 in include/ipc/fs.h.'>FS_TRUNCATE</a>,    <a href='903.html#L820' title='Defined at 820 in usr/server/fs/vfs/main.c.'>fs_truncate</a> ),
<a id='L1013' name='L1013' />1013         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L82' title='Defined at 82 in include/ipc/fs.h.'>FS_FTRUNCATE</a>,   <a href='903.html#L834' title='Defined at 834 in usr/server/fs/vfs/main.c.'>fs_ftruncate</a> ),
<a id='L1014' name='L1014' />1014         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='219.html#L83' title='Defined at 83 in include/ipc/fs.h.'>FS_FCHDIR</a>,      <a href='903.html#L451' title='Defined at 451 in usr/server/fs/vfs/main.c.'>fs_fchdir</a> ),
<a id='L1015' name='L1015' />1015         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='220.html#L55' title='Defined at 55 in include/ipc/ipc.h.'>STD_BOOT</a>,       <a href='903.html#L848' title='Defined at 848 in usr/server/fs/vfs/main.c.'>fs_boot</a> ),
<a id='L1016' name='L1016' />1016         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='220.html#L56' title='Defined at 56 in include/ipc/ipc.h.'>STD_SHUTDOWN</a>,   <a href='903.html#L883' title='Defined at 883 in usr/server/fs/vfs/main.c.'>fs_shutdown</a> ),
<a id='L1017' name='L1017' />1017 <em class='sharp'>#ifdef</em> <a href='../Y/117.html' title='Multiple used in 9 places.'>DEBUG_VFS</a>
<a id='L1018' name='L1018' />1018         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( <a href='220.html#L54' title='Defined at 54 in include/ipc/ipc.h.'>STD_DEBUG</a>,      <a href='903.html#L901' title='Defined at 901 in usr/server/fs/vfs/main.c.'>fs_debug</a> ),
<a id='L1019' name='L1019' />1019 <em class='sharp'>#endif</em>
<a id='L1020' name='L1020' />1020         <a href='../D/1035.html' title='Multiple defined in 2 places.'>MSGMAP</a>( 0,              <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a> ),
<a id='L1021' name='L1021' />1021 <em class='brace'>}</em>;
<a id='L1022' name='L1022' />1022 
<a id='L1023' name='L1023' />1023 <em class='comment'>/*</em>
<a id='L1024' name='L1024' />1024 <em class='comment'> * File system thread.</em>
<a id='L1025' name='L1025' />1025 <em class='comment'> */</em>
<a id='L1026' name='L1026' />1026 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L1027' name='L1027' />1027 <a href='../R/1928.html' title='Multiple refered from 2 places.'>fs_thread</a>(<strong class='reserved'>void</strong>)
<a id='L1028' name='L1028' />1028 <em class='brace'>{</em>
<a id='L1029' name='L1029' />1029         <strong class='reserved'>struct</strong> <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> *<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>;
<a id='L1030' name='L1030' />1030         <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../Y/1317.html' title='Multiple used in 12 places.'>msg_map</a> *<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>;
<a id='L1031' name='L1031' />1031         <strong class='reserved'>struct</strong> <a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a> *<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>;
<a id='L1032' name='L1032' />1032         <strong class='reserved'>int</strong> <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L1033' name='L1033' />1033 
<a id='L1034' name='L1034' />1034         <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a> = <a href='../D/3029.html' title='Multiple defined in 7 places.'>malloc</a>(<a href='219.html#L171' title='Defined at 171 in include/ipc/fs.h.'>MAX_FSMSG</a>);
<a id='L1035' name='L1035' />1035 
<a id='L1036' name='L1036' />1036         <em class='comment'>/*</em>
<a id='L1037' name='L1037' />1037 <em class='comment'>         * Message loop</em>
<a id='L1038' name='L1038' />1038 <em class='comment'>         */</em>
<a id='L1039' name='L1039' />1039         <strong class='reserved'>for</strong> (;;) <em class='brace'>{</em>
<a id='L1040' name='L1040' />1040                 <em class='comment'>/*</em>
<a id='L1041' name='L1041' />1041 <em class='comment'>                 * Wait for an incoming request.</em>
<a id='L1042' name='L1042' />1042 <em class='comment'>                 */</em>
<a id='L1043' name='L1043' />1043                 <strong class='reserved'>if</strong> ((<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='324.html#L188' title='Defined at 188 in sys/ipc/msg.c.'>msg_receive</a>(<a href='../Y/931.html' title='Multiple used in 13 places.'>fsobj</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>, <a href='219.html#L171' title='Defined at 171 in include/ipc/fs.h.'>MAX_FSMSG</a>)) != 0)
<a id='L1044' name='L1044' />1044                         <strong class='reserved'>continue</strong>;
<a id='L1045' name='L1045' />1045 
<a id='L1046' name='L1046' />1046                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='256.html#L62' title='Defined at 62 in include/sys/errno.h.'>EINVAL</a>;
<a id='L1047' name='L1047' />1047                 <a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a> = &amp;<a href='../Y/929.html' title='Multiple used in 2 places.'>fsmsg_map</a>[0];
<a id='L1048' name='L1048' />1048                 <strong class='reserved'>while</strong> (<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> != 0) <em class='brace'>{</em>
<a id='L1049' name='L1049' />1049                         <strong class='reserved'>if</strong> (<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> == <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a>) <em class='brace'>{</em>
<a id='L1050' name='L1050' />1050                                 <em class='comment'>/*</em>
<a id='L1051' name='L1051' />1051 <em class='comment'>                                 * Handle messages by non-registerd tasks</em>
<a id='L1052' name='L1052' />1052 <em class='comment'>                                 */</em>
<a id='L1053' name='L1053' />1053                                 <strong class='reserved'>if</strong> (<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> == <a href='220.html#L55' title='Defined at 55 in include/ipc/ipc.h.'>STD_BOOT</a>) <em class='brace'>{</em>
<a id='L1054' name='L1054' />1054                                         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='903.html#L848' title='Defined at 848 in usr/server/fs/vfs/main.c.'>fs_boot</a>(<a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>);
<a id='L1055' name='L1055' />1055                                         <strong class='reserved'>break</strong>;
<a id='L1056' name='L1056' />1056                                 <em class='brace'>}</em>
<a id='L1057' name='L1057' />1057                                 <strong class='reserved'>if</strong> (<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> == <a href='219.html#L78' title='Defined at 78 in include/ipc/fs.h.'>FS_REGISTER</a>) <em class='brace'>{</em>
<a id='L1058' name='L1058' />1058                                         <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = <a href='903.html#L747' title='Defined at 747 in usr/server/fs/vfs/main.c.'>fs_register</a>(<a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>);
<a id='L1059' name='L1059' />1059                                         <strong class='reserved'>break</strong>;
<a id='L1060' name='L1060' />1060                                 <em class='brace'>}</em>
<a id='L1061' name='L1061' />1061 
<a id='L1062' name='L1062' />1062                                 <em class='comment'>/* Lookup and lock task */</em>
<a id='L1063' name='L1063' />1063                                 <a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a> = <a href='912.html#L70' title='Defined at 70 in usr/server/fs/vfs/vfs_task.c.'>task_lookup</a>(<a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>);
<a id='L1064' name='L1064' />1064                                 <strong class='reserved'>if</strong> (<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a> == <a href='../D/1107.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L1065' name='L1065' />1065                                         <strong class='reserved'>break</strong>;
<a id='L1066' name='L1066' />1066 
<a id='L1067' name='L1067' />1067                                 <em class='comment'>/* Dispatch request */</em>
<a id='L1068' name='L1068' />1068                                 <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a> = (*<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/962.html' title='Multiple used in 37 places.'>func</a>)(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>);
<a id='L1069' name='L1069' />1069                                 <strong class='reserved'>if</strong> (<a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a> != <a href='219.html#L77' title='Defined at 77 in include/ipc/fs.h.'>FS_EXIT</a>)
<a id='L1070' name='L1070' />1070                                         <a href='912.html#L154' title='Defined at 154 in usr/server/fs/vfs/vfs_task.c.'>task_unlock</a>(<a href='../Y/2081.html' title='Multiple used in 688 places.'>t</a>);
<a id='L1071' name='L1071' />1071                                 <strong class='reserved'>break</strong>;
<a id='L1072' name='L1072' />1072                         <em class='brace'>}</em>
<a id='L1073' name='L1073' />1073                         <a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>++;
<a id='L1074' name='L1074' />1074                 <em class='brace'>}</em>
<a id='L1075' name='L1075' />1075 <em class='sharp'>#ifdef</em> <a href='../Y/117.html' title='Multiple used in 9 places.'>DEBUG_VFS</a>
<a id='L1076' name='L1076' />1076                 <strong class='reserved'>if</strong> (<a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>)
<a id='L1077' name='L1077' />1077                         <a href='747.html#L37' title='Defined at 37 in usr/lib/prex/gen/dprintf.c.'>dprintf</a>("VFS: task=%x code=%x error=%d\n",
<a id='L1078' name='L1078' />1078                                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2117.html' title='Multiple used in 389 places.'>task</a>, <a href='../Y/1246.html' title='Multiple used in 175 places.'>map</a>-&gt;<a href='../Y/540.html' title='Multiple used in 111 places.'>code</a>, <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>);
<a id='L1079' name='L1079' />1079 <em class='sharp'>#endif</em>
<a id='L1080' name='L1080' />1080                 <em class='comment'>/*</em>
<a id='L1081' name='L1081' />1081 <em class='comment'>                 * Reply to the client.</em>
<a id='L1082' name='L1082' />1082 <em class='comment'>                 */</em>
<a id='L1083' name='L1083' />1083                 <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>-&gt;<a href='../Y/1007.html' title='Multiple used in 163 places.'>hdr</a>.<a href='../Y/2027.html' title='Multiple used in 39 places.'>status</a> = <a href='../D/2604.html' title='Multiple defined in 3 places.'>error</a>;
<a id='L1084' name='L1084' />1084                 <a href='324.html#L288' title='Defined at 288 in sys/ipc/msg.c.'>msg_reply</a>(<a href='../Y/931.html' title='Multiple used in 13 places.'>fsobj</a>, <a href='../Y/1315.html' title='Multiple used in 435 places.'>msg</a>, <a href='219.html#L171' title='Defined at 171 in include/ipc/fs.h.'>MAX_FSMSG</a>);
<a id='L1085' name='L1085' />1085         <em class='brace'>}</em>
<a id='L1086' name='L1086' />1086 <em class='brace'>}</em>
<a id='L1087' name='L1087' />1087 
<a id='L1088' name='L1088' />1088 <em class='comment'>/*</em>
<a id='L1089' name='L1089' />1089 <em class='comment'> * Main routine for file system service</em>
<a id='L1090' name='L1090' />1090 <em class='comment'> */</em>
<a id='L1091' name='L1091' />1091 <strong class='reserved'>int</strong>
<a id='L1092' name='L1092' />1092 <a href='../R/2134.html' title='Multiple refered from 2 places.'>main</a>(<strong class='reserved'>int</strong> <a href='../Y/385.html' title='Multiple used in 381 places.'>argc</a>, <strong class='reserved'>char</strong> *<a href='../Y/388.html' title='Multiple used in 440 places.'>argv</a>[])
<a id='L1093' name='L1093' />1093 <em class='brace'>{</em>
<a id='L1094' name='L1094' />1094         <strong class='reserved'>int</strong> <a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a>;
<a id='L1095' name='L1095' />1095 
<a id='L1096' name='L1096' />1096         <a href='333.html#L158' title='Defined at 158 in sys/kern/system.c.'>sys_log</a>("Starting file system server\n");
<a id='L1097' name='L1097' />1097 
<a id='L1098' name='L1098' />1098         <a href='../D/295.html' title='Multiple defined in 58 places.'>DPRINTF</a>(<a href='905.html#L52' title='Defined at 52 in usr/server/fs/vfs/vfs.h.'>VFSDB_CORE</a>, ("VFS: number of fs threads: %d\n",
<a id='L1099' name='L1099' />1099                              <a href='../Y/70.html' title='Multiple used in 16 places.'>CONFIG_FS_THREADS</a>));
<a id='L1100' name='L1100' />1100 
<a id='L1101' name='L1101' />1101         <em class='comment'>/* Set thread priority. */</em>
<a id='L1102' name='L1102' />1102         <a href='810.html#L35' title='Defined at 35 in usr/lib/prex/syscalls/thread_setpri.c.'>thread_setpri</a>(<a href='335.html#L201' title='Defined at 201 in sys/kern/thread.c.'>thread_self</a>(), <a href='264.html#L92' title='Defined at 92 in include/sys/param.h.'>PRI_FS</a>);
<a id='L1103' name='L1103' />1103 
<a id='L1104' name='L1104' />1104         <em class='comment'>/* Setup exception handler */</em>
<a id='L1105' name='L1105' />1105         <a href='328.html#L97' title='Defined at 97 in sys/kern/exception.c.'>exception_setup</a>(<a href='../D/2615.html' title='Multiple defined in 4 places.'>exception_handler</a>);
<a id='L1106' name='L1106' />1106 
<a id='L1107' name='L1107' />1107         <em class='comment'>/* Initialize the file systems. */</em>
<a id='L1108' name='L1108' />1108         <a href='903.html#L913' title='Defined at 913 in usr/server/fs/vfs/main.c.'>vfs_init</a>();
<a id='L1109' name='L1109' />1109 
<a id='L1110' name='L1110' />1110         <em class='comment'>/* Create an object to expose our service. */</em>
<a id='L1111' name='L1111' />1111         <strong class='reserved'>if</strong> (<a href='325.html#L81' title='Defined at 81 in sys/ipc/object.c.'>object_create</a>("!fs", &amp;<a href='../Y/931.html' title='Multiple used in 13 places.'>fsobj</a>))
<a id='L1112' name='L1112' />1112                 <a href='333.html#L208' title='Defined at 208 in sys/kern/system.c.'>sys_panic</a>("VFS: fail to create object");
<a id='L1113' name='L1113' />1113 
<a id='L1114' name='L1114' />1114         <em class='comment'>/*</em>
<a id='L1115' name='L1115' />1115 <em class='comment'>         * Create new server threads.</em>
<a id='L1116' name='L1116' />1116 <em class='comment'>         */</em>
<a id='L1117' name='L1117' />1117         <a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a> = <a href='../Y/70.html' title='Multiple used in 16 places.'>CONFIG_FS_THREADS</a>;
<a id='L1118' name='L1118' />1118         <strong class='reserved'>while</strong> (--<a href='../Y/1027.html' title='Multiple used in 699 places.'>i</a> &gt; 0) <em class='brace'>{</em>
<a id='L1119' name='L1119' />1119                 <strong class='reserved'>if</strong> (<a href='../D/3351.html' title='Multiple defined in 2 places.'>run_thread</a>(<a href='903.html#L1027' title='Defined at 1027 in usr/server/fs/vfs/main.c.'>fs_thread</a>))
<a id='L1120' name='L1120' />1120                         <strong class='reserved'>goto</strong> <a href='472.html#L35' title='Defined at 35 in usr/lib/libc/gen/err.c.'>err</a>;
<a id='L1121' name='L1121' />1121         <em class='brace'>}</em>
<a id='L1122' name='L1122' />1122         <a href='903.html#L1027' title='Defined at 1027 in usr/server/fs/vfs/main.c.'>fs_thread</a>();
<a id='L1123' name='L1123' />1123 
<a id='L1124' name='L1124' />1124         <a href='333.html#L208' title='Defined at 208 in sys/kern/system.c.'>sys_panic</a>("VFS: exit!");
<a id='L1125' name='L1125' />1125         <a href='569.html#L42' title='Defined at 42 in usr/lib/libc/stdlib/exit.c.'>exit</a>(0);
<a id='L1126' name='L1126' />1126  <a href='472.html#L35' title='Defined at 35 in usr/lib/libc/gen/err.c.'>err</a>:
<a id='L1127' name='L1127' />1127         <a href='333.html#L208' title='Defined at 208 in sys/kern/system.c.'>sys_panic</a>("VFS: failed to create thread");
<a id='L1128' name='L1128' />1128         <strong class='reserved'>return</strong> 0;
<a id='L1129' name='L1129' />1129 <em class='brace'>}</em>
</pre>
<hr />
<a id='BOTTOM' name='BOTTOM' />
<em class='comment'>/* [&lt;][&gt;]<a href='903.html#L89'>[^]</a><a href='903.html#L1092'>[v]</a><a href='903.html#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<br />    <tr>
      <td id="footer" colspan="2" style="vertical-align: top;">
        <a href="http://sourceforge.net">
        <img src="http://sourceforge.net/sflogo.php?group_id=132028&amp;type=1"
        alt="SourceForge.net Logo" border="0" height="31" width="88"></a><br>
        Copyright&copy; 2005-2009 Kohsuke Ohtani
      </td>
    </tr>

    </tr>
  </tbody>
</table>
</div>
</body>
</body>
</html>
